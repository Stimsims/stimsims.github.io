{"version":3,"sources":["webpack:///./src/apis/firebase/firestoreFunctions.js","webpack:///./src/apis/SignIn/GetGapi.js","webpack:///./src/apis/SignIn/SignIn.js","webpack:///./src/apis/classroom/getters/SelectCourseWork/classroom.css.js","webpack:///./src/apis/classroom/getters/SelectCourseWork/index.js","webpack:///./src/apis/config.js","webpack:///./src/apis/Stripe/CardForm/index.js","webpack:///./src/apis/Stripe/PaymentButton/index.js","webpack:///./src/apis/Stripe/Provider/index.js","webpack:///./src/apis/SignIn/NestedSignIn.js","webpack:///./src/apis/Paypal/index.js","webpack:///./src/apis/firebase/gapiFunctions.js","webpack:///./src/apis/classroom/getters/SelectSubmission/index.js","webpack:///./src/apis/classroom/SubmitCourseWork/index.js","webpack:///./functions/dbConfig.js","webpack:///./src/games/keys.js","webpack:///./src/apis/firebase/cloudFunctions.js","webpack:///./src/templates/game-post.js","webpack:///./src/apis/classroom/getters/SelectCourse/index.js","webpack:///./src/apis/LoadScript.js"],"names":["firebase","require","dbConfig","firestoreThen","callback","e","log","exists","r","data","success","error","Error","message","firestoreThenInline","firestoreCatch","getPlayer","uid","firestore","collection","COLLECTION_PLAYERS","doc","get","then","saveExam","examId","save","COLLECTION_EXAMS","update","deleteExam","delete","FieldValue","config","clientId","scope","discoveryDocs","Subscribable","props","LoadScript","apiKey","script","onLoad","gapi","load","doSubscribe","client","init","onApiInit","sendError","signInOptions","provider","auth","TwitterAuthProvider","PROVIDER_ID","FacebookAuthProvider","uiConfig","signInFlow","callbacks","SignOutWrapper","SignInHoC","View","redirectUrl","needsGoogle","useState","setError","isGapiReady","setIsGapiReady","user","setUser","uiInstance","setUiInstance","onAuthStateChanged","getUser","useEffect","deleteUi","getUi","isSigningIn","window","firebaseui","showSignInUi","apps","length","initializeApp","globalHistory","location","hostname","setFirebaseToWindow","ref","onSignOut","signOut","navigate","getUrl","permissions","attempts","console","ui","setPersistence","Auth","Persistence","NONE","resetUi","signInSuccessUrl","signInSuccessWithAuthResult","postSignIn","startUi","fui","AuthUI","getInstance","getUiId","reset","newfui","google","GoogleAuthProvider","scopes","customParameters","getGoogleProvider","start","authResult","credential","setToken","access_token","accessToken","getUrlHash","isSignedIn","u","email","displayName","photoURL","phoneNumber","createTime","metadata","creationTime","lastTime","lastSignInTime","providerData","reduce","agg","el","i","providerId","SignInWrapper","Helmet","type","rel","href","GetGapi","StateBackground","signingIn","StateView","className","IconButton","icon","onInput","color","bgColor","Text","key","id","fontSize","trget","doSignOut","deleteUser","currentUser","doSignIn","styled","div","theme","zUi","zTop","List","section","SubscriptionHoC","courseWork","setCourseWork","nextPageToken","setNextPageToken","handleGetCourseWork","getCourseWork","courseId","pageSize","result","filteredCw","filter","f","associatedWithDeveloper","filterByTitle","title","indexOf","map","cw","adj","dueTime","hours","Date","label","dueDate","year","month","day","toLocaleDateString","value","cloudCatch","onError","ANIM_LAYOUT_OVERLAP","style","height","rotate","text","Select","options","placeholder","val","onSelect","courseWorkId","Loading","delay","authDomain","databaseURL","projectId","storageBucket","studentPermissions","drivePermissions","teacherCreatePermissions","teacherMarkPermissions","CARD_ELEMENT_OPTIONS","base","letterSpacing","invalid","injectStripe","handleSubmit","ev","a","stripe","createToken","name","token","handlePayment","CardStyles","onSubmit","Button","disabled","form","canMakePayment","setCanMakePayment","paymentRequest","setPaymentRequest","country","currency","PAY_CURRENCY","total","amount","on","complete","paymentRequestButton","API_KEY","STRIPE_API_KEY","styleStripe","paddingTop","setStripe","fsm","setFsm","getUid","paymentIntent","setPaymentIntent","Stripe","onCreatePaymentIntent","document","querySelector","addEventListener","sendEvent","Event","createPaymentIntent","paymentType","paymentIntentId","onPaymentError","code","confirmCardPayment","paymentIntentSecret","card","billing_details","status","onAccess","decline_code","tag","paymentValue","renderFsm","AuthenticatedExamView","SignIn","recieveSignInProps","stylesPaypal","borderBox","padding","maxHeight","overflow","loading","setLoading","paypal","renderPaypalButton","err","getItem","PAY_EXAM_VALUE_PAYPAL","PAY_REPORT_VALUE_PAYPAL","Buttons","createOrder","actions","pp","payer","application_context","purchase_units","breakdown","item_total","currency_code","items","order","create","onApprove","capturePaypalPayment","orderID","catch","render","PAYPAL_LIVE_API_KEY","PAYPAL_MODE","PAYPAL_SANDBOX_API_KEY","classroomThen","Array","isArray","createReport","body","results","reportId","reportLink","docType","mediaType","params","appProps","fields","appProperties","media","mimeType","drive","files","contentType","createAFile","webViewLink","request","path","method","uploadType","published","lookAtAssignments","totalAssignments","classroom","courses","studentSubmissions","list","filtered","state","userId","link","alternateLink","latest","Promise","all","ss","assignmentSubmission","attachments","fileId","driveFile","file","gameGrade","markGradedAssignments","grades","returnAssignment","grade","mapped","hasOwnProperty","updateMask","draftGrade","assignedGrade","patch","return","turnIn","submissionId","modifyAttachments","addAttachments","reclaimSubmission","reclaim","createCoursework","coursework","getCourses","pageToken","getSubmissionsforCourseWork","listStudents","students","setStudentSubmissions","handleSelectSubmission","handleSelect","item","handleReclaim","course","Fragment","compact","getSubmissionView","withTheme","setCourseId","setCourseWorkId","submission","setSubmission","changeState","payload","submitAssignment","cId","cwId","sId","fun","buildDocument","game","meta","q","roundTo","finalMark","target","subscribe","SelectCourseWork","SelectCourse","renderState","exports","COLLECTION_PAYMENTS","PAY_EXAM_VALUE","PAY_EXAM_VALUE_STRIPE","PAY_REPORT_VALUE","PAY_REPORT_VALUE_STRIPE","PRODUCT_EXAM","PRODUCT_REPORT","PAYPAL_ID","STRIPE_ID","FREE_EXAM","FREE_REPORT","INITIAL_PLAYER_STATE","reportcount","examcount","getUnlockedKey","getCounterKey","getFreeAmount","getRefundAmount","getPaymentAmount","vendor","product","validateProduct","VENDOR_PAYPAL","VENDOR_STRIPE","module","DELETED","aMath","aErr","acMath","acGameMCQ","acFeature","acGame","acSim","acModal","acMenu","acDia","acSimCom","acSimFinalScore","acLoc","aclocData","aclocStory","actModBuild","actModAccept","actModFinal","actPredBuild","actPredAccept","actPredFinal","aclocChar","acAct","acChoice","c","act","lab","aMathTool","aMove","mMeas","prim","secon","cdSound","cdDiff","cdDiffSes","setDiff","setSound","setAni","setExam","setFont","scoreRange","dp","modelValue","userValue","cloudThen","fail","cloudThenInline","loadExam","functions","httpsCallable","createExam","settings","deletePlayer","updateExam","node","local","endGame","eventId","checkCustomerStatus","refundPayment","validateCaptcha","v2","authorizationID","styles","position","motionStyles","width","top","transform","GamePost","Loader","setLoad","images","setImages","loadable","Load","Main","addMenuItem","logo","getCharacterSrc","gameImages","img","src","childImageSharp","fluid","site","siteMetadata","host","getHost","tags","topics","description","snippet","twitterCard","fixed","iconAlt","descriptions","d","errorView","siteUrl","BUILD_GAME","Loadable","Map","timeout","loader","getGame","import","stack","loaded","default","audio","SyntaxError","pageQuery","setCourses","createCourseWork","loadScript","createElement","onload","appendChild","propTypes","PropTypes","func","string"],"mappings":"8FAAA,0LAAMA,EAAWC,EAAQ,QAEzBA,EAAQ,QAIR,IAAMC,EAAWD,EAAQ,QAEZE,EAAgB,SAACC,GAAD,OAAc,SAACC,GAGxC,GADAC,YAAI,0BAA2BD,GAC3BA,EAEE,GAAGA,EAAEE,OAAO,CACd,IAAIC,EAAIH,EAAEI,OACVL,EAASI,OACP,KAAGH,EAAEI,OAAQJ,EAAEI,KAAKC,QAEpB,MAAGL,EAAEM,MACD,IAAIC,MAAMP,EAAEM,MAAME,SAElB,IAAID,MAAM,wBAJhBR,EAASC,EAAEI,KAAKC,cALhBN,EAAS,QAYJU,EAAuB,SAACT,GAIjC,GADAC,YAAI,2BAA4BD,GAC7BA,EAAEE,OAED,OADQF,EAAEI,OAER,GAAGJ,EAAEI,MAAQJ,EAAEI,KAAKC,QACtB,OAAOL,EAAEI,KAAKC,QACZ,MAAGL,EAAEM,MACD,IAAIC,MAAMP,EAAEM,MAAME,SAElB,IAAID,MAAM,yBAIXG,EAAiB,SAACV,GAE3B,MAAgB,iBAANA,EAECA,EACFA,EAAEM,MAEAN,EAAEM,MAAME,QAIT,wBAIDG,EAAY,SAACC,GACtB,OAAOjB,EAASkB,YAAYC,WAAWjB,EAASkB,oBAAoBC,IAAIJ,GAAKK,MAC5EC,KAAKT,IASGU,EAAW,SAACP,EAAKQ,EAAQC,GAClC,OAAO1B,EAASkB,YAAYC,WAAWjB,EAASkB,oBACnBC,IAAIJ,GACJE,WAAWjB,EAASyB,kBACpBN,IAAII,GAAQG,OAAO,CAChBF,UAIvBG,EAAa,SAACZ,EAAKQ,GAC5B,OAAOzB,EAASkB,YACCC,WAAWjB,EAASkB,oBACpBC,IAAIJ,GACJE,WAAWjB,EAASyB,kBACpBN,IAAII,GAAQK,SACZP,MAAK,SAAAlB,GAAM,IAAD,EACP,OAAOL,EAASkB,YAAYC,WAAWjB,EAASkB,oBAAoBC,IAAIJ,GAAKW,SAAtE,eACOH,GAAWzB,EAASkB,UAAUa,WAAWD,SADhD,S,sRC1EzBE,EAAS,CACXC,SAAU,2EACVC,MAAO,6CACPC,cAAe,CACb,6DACA,mEA0BSC,eAtBF,SAACC,GAkBV,OAAO,kBAACC,EAAA,EAAD,CAAYC,OAAO,MAAMC,OAAO,oCACnCC,OAjBW,SAACpC,GAEZqC,KAAKC,KAAK,UAAU,WAChBN,EAAMO,YAAY,WAAW,WAAK,OAAOF,KAAKG,OAAOC,KAAKd,MAC1D,SAACxB,GACC6B,EAAMU,UAAU,WAElB,SAAA1C,GACE2C,YAAU,gCAEZ,SAAC3C,GACC2C,YAAU,0C,gzBCLxB,IAAMC,EAAgB,CAClB,CACIC,SAAUlD,IAASmD,KAAKC,oBAAoBC,aAEhD,CACIH,SAAUlD,IAASmD,KAAKG,qBAAqBD,cAkB/CE,EAAW,CACbC,WAAY,WACZC,UAAW,IA2NTC,GAFSC,IApNG,SAACC,EAAMC,EAAaC,GAApB,OAAoC,SAAAzB,GAClD,IAAIA,EAAMO,YACN,MAAMhC,MAAM,6CAF2C,MAIjCmD,mBAAS,MAA5BpD,EAJoD,KAI7CqD,EAJ6C,OAKrBD,oBAAS,GAAxCE,EALoD,KAKvCC,EALuC,OAMlCH,oBAAS,GAA1BI,EANmD,KAM7CC,EAN6C,OAOvBL,mBAAS,MAAtCM,EAPoD,KAOxCC,EAPwC,KASrDC,EAAqB,SAACJ,GACxBC,EAAQI,EAAQL,KAEpBM,qBAAU,WACN,OAAO,WACHC,EAASL,GAAcM,QAG/B,CAACN,IACDI,qBAAU,WACHG,KAAiBC,OAAOC,YACvBC,MAEL,CAACd,EAAaE,IACjBM,qBAAU,WAENI,OAAO7E,SAAWA,IACU,IAAzBA,IAASgF,KAAKC,SAEbjF,IAASkF,cAAclD,KACpBmD,gBAAcC,SAASC,UAI3BR,QAAUA,OAAOnC,OAASuB,GACzBC,GAAe,GAEnBlE,IAASmD,OAAOoB,mBAAmBA,GACnCe,MACD,IACH,IAMMA,EAAsB,SAACC,GACzBV,OAAO7E,SAAWA,KAGhBwF,EAAY,WACd,OAAOnD,EAAMO,YAAY,aAAa,WAAK,OAAO5C,IAASmD,OAAOsC,aAClE,SAAApF,GAII,OAFAqE,EAASC,KACTe,mBAASC,oBACF,CAACjF,QAAS,iBAErB,SAAAL,GACI,MAAO,CAACM,MAAM,yBAElBqD,IAGEe,EAAe,SAAfA,EAAgBa,EAAaC,QAAiB,IAAjBA,MAAW,GAC1CC,QAAQxF,IAAR,uBAAoC+B,GACpC,IAAI0D,EAAKpB,IACT,GAAIoB,EAgBAL,mBAASC,mBApFH,oBAqEN,IACI3F,IAASmD,OAAO6C,eAAehG,IAASmD,KAAK8C,KAAKC,YAAYC,MAE9DC,EAAQL,GACRxC,EAAS8C,iBAAmBxC,EA1E3B,aA2EDgB,OAAOO,SAAWO,mBA1EhB,cA2EFpC,EAASE,UAAU6C,4BAA+BC,EAElDC,EAAQZ,GACX,MAAMvF,GACAwF,EAAW,GACVd,EAAaa,EAAaC,EAAW,KAO/ClB,EAAQ,WAEX,IAAI8B,EAOH,OANE3B,aACF2B,EAAM3B,WAAW3B,KAAKuD,OAAOC,YAAYC,MAEtCH,IACAA,EAAMpC,GAEFoC,GAEL/B,EAAW,SAAC+B,GACdnC,EAAc,MACXmC,GAAKA,EAAI3E,UAGVsE,EAAU,SAACK,GACbnC,EAAc,MACXmC,GAAKA,EAAII,SAEVL,EAAU,SAACZ,GAEb,IAAIkB,EAASnC,IACb,IAAImC,EAAO,CAEC9G,IAASmD,OACjB2D,EAAS,IAAIhC,WAAW3B,KAAKuD,OAAO1G,IAASmD,OAAQyD,KAEzD,IAAIG,EAtIc,SAACnB,GACvB,MAAO,CACH1C,SAAUlD,IAASmD,KAAK6D,mBAAmB3D,YAC3C4D,OAAQrB,EACRsB,iBAAkB,CAId,wBAA0B,IA8HjBC,CAAkBvB,GAC/BkB,EAAOM,MAAM,IAAMR,IAAnB,iBAAkCrD,EAAlC,CACIN,cAAc,CAAE8D,GAAH,SAAcjD,EAAY,GAAGb,QAG5CsD,EAAa,SAACc,GAIhB,OAHGxC,QAAUA,OAAOnC,MAAQmC,OAAOnC,KAAKG,QAAUwE,GAAcA,EAAWC,YACvE5E,KAAKG,OAAO0E,SAAS,CAACC,aAAcH,EAAWC,WAAWG,eAEvD,GAIL7C,EAAc,WAChB,MAjIU,gBAiIH8C,wBAKLC,EAAa,WAEf,QAAGxD,GAeDK,EAAU,SAACoD,GACb,OAAGA,EAEQ,CAAC3G,IAAK2G,EAAE3G,IAAK4G,MAAOD,EAAEC,MAAOC,YAAaF,EAAEE,YAAaC,SAAUH,EAAEG,SACxEC,YAAaJ,EAAEI,YAAaC,WAAYL,EAAEM,SAASC,aAAcC,SAAUR,EAAEM,SAASG,eACtFnF,SAAU0E,EAAEU,aAAaC,QAAO,SAACC,EAAKC,EAAIC,GACtC,OAAOF,GAASE,EAAI,EAAE,KAAK,IAAKD,EAAGE,aACpC,KAEJ,MAGL/B,EAAU,WACZ,MAAM,6BAEV,OACQ,kBAACgC,EAAD,KACI,kBAACC,EAAA,EAAD,KACI,0BAAMC,KAAK,WAAWC,IAAI,aAAaC,KAAK,sEAEhD,kBAACC,EAAD,CAASlG,UAvBC,WAClBmB,GAAe,MAuBP,kBAAC5B,EAAA,EAAD,CAAYG,OAAQ6C,EAChB9C,OAAO,oEAGX,kBAAC0G,EAAD,CAAiBC,UAAWvE,KACxB,kBAACwE,EAAD,CAAWD,UAAWvE,IAAeyE,UAAU,cAC3C,kBAACC,EAAA,EAAD,CACID,UAAU,gBACVE,KAAK,aACLC,QAlDH,WACjB9D,mBAASC,qBAkDW8D,MAAM,UACNC,QAAQ,UAGX9E,KAAiB,6BACd,kBAAC+E,EAAA,EAAD,CAAMC,IAAI,eAAeC,GAAG,eAAeC,SAAS,OAAOT,UAAU,UAArE,qFAGA,uBAAGL,KAAM,WAAYe,MAAM,UAA3B,mBAIHpJ,GAAS,kBAACgJ,EAAA,EAAD,CAAMC,IAAI,aAAaC,GAAG,aAAcR,UAAU,eAAlD,SAGV,yBAAKQ,GAAIjD,IAAWyC,UAAU,sBAGrC1B,KAAgB,kBAACjE,EAAD,KACb,kBAACiG,EAAA,EAAD,CAAMC,IAAI,WAAWC,GAAG,WAAWR,UAAU,iBAAiBG,QAAShE,GAAvE,aAEJvB,GAAgB,yBAAKoF,UAAS,eAAgB1B,IAAa,WAAW,gBACvE,kBAAC/D,EAAD,iBAAUvB,EAAV,CAAiBsF,WAAYA,IAAcxD,KAAMA,EAAM6F,UAAWxE,EAAWyE,WAhErE,WACf,IAAIrC,EAAI5H,IAASmD,OAAO+G,YACxB,GAAGtC,EACC,OAAO,WACH,OAAOA,EAAE9F,WA6DTmC,YAAaA,EAAakG,SAAUpF,SAW7BqF,IAAOC,IAAV,6EAAGD,CAAH,qDAOdxB,EAAgBwB,IAAOC,IAAV,4EAAGD,CAAH,mCAIblB,EAAkBkB,IAAOC,IAAV,8EAAGD,CAAH,sKAOO,SAAA/H,GAAK,OAAIA,EAAM8G,UAAU,KAAK,WAE3C,SAAA9G,GAAK,OAAIA,EAAMiI,MAAMC,OAE9BnB,EAAYgB,IAAOC,IAAV,wEAAGD,CAAH,gIAKA,SAAA/H,GAAK,OAAIA,EAAMiI,MAAME,S,+ICtSvBC,EAAOL,IAAOM,QAAV,yEAAGN,CAAH,sJ,GAgBOA,IAAOC,IAAV,6EAAGD,CAAH,4H,2DCkENO,iBArEU,SAACtI,GAAW,IAAD,EACI0B,mBAAS,MAAtC6G,EADyB,KACbC,EADa,OAEU9G,mBAAS,MAA5C+G,EAFyB,KAEVC,EAFU,KAGhCtG,qBAAU,WACNuG,MACD,IACH,IAAMA,EAAuB,WACzB3I,EAAMO,YAAY,iCACd,WAAK,OAAOqI,YAAc5I,EAAM6I,SAAU7I,EAAM8I,UAT1C,GASiEL,MACvE,SAAAM,GAKI,IAJGA,EAAON,eAAkBA,IAAkBM,EAAON,gBACjDC,EAAiBK,EAAON,gBAGzBM,EAAOR,WAuBN,MAAM,IAAIhK,MAAJ,kCAA4CyB,EAAM6I,UAtBxD,IACIG,EAAaD,EAAOR,WAAWU,QAAO,SAAAC,GAAC,OAAIA,EAAEC,2BAC9CnJ,EAAMoJ,gBACLJ,EAAaA,EAAWC,QAAO,SAAAC,GAC3B,OAAOA,EAAEG,MAAMC,QAAQtJ,EAAMoJ,gBAAmB,MAKxDZ,EAAcQ,EAAWO,KAAI,SAAAC,GAEzB,IAAIC,EAAOD,EAAGE,QAAQC,MAAQ,GAAKH,EAAGE,QAAQC,MAAQ,GAAI,EAAE,EAE5D,OADO,IAAIC,KAAKJ,EAAG1D,cACZ,CAAC+D,MAAM,UAAWL,EAAGH,MAAf,eACT,IAAIO,KACAJ,EAAGM,QAAQC,KACXP,EAAGM,QAAQE,MAAM,EACjBP,EAAMD,EAAGM,QAAQG,IACjBT,EAAGE,QAAQC,OACbO,qBAAwBC,MAAOX,EAAGhC,UAMpD4C,IACApK,EAAMqK,UAOd,OAAO,kBAAC,IAAD,KACF9B,GAAc,kBAAC,IAAOP,IAAR,eAAYT,IAAI,aAAgB+C,KACvC,kBAAClC,EAAD,KACA,yBAAKmC,MAAO,CAACC,OAAQ,SACpB/B,GAAiB,kBAACxB,EAAA,EAAD,CAAYD,UAAU,WAAWE,KAAK,mBAAmBO,SAAS,OAChFgD,OAAO,MAAMtD,QAASwB,EAAqB+B,KAAK,eAEpD,kBAACC,EAAA,EAAD,CAAQnD,GAAG,mBAAmBoD,QAASrC,EAAYvB,UAAU,QAAQ6D,YAAY,oBAAoB1D,QAX5F,SAACK,EAAIsD,GACtB9K,EAAM+K,SAAS/K,EAAMwH,GAAI,CAACqB,SAAU7I,EAAM6I,SAAUmC,aAAcF,UAYhEvC,GAAc,kBAAC,IAAOP,IAAR,eAAYT,IAAI,WAAc+C,KAC1C,kBAACW,EAAA,EAAD,CAAS1D,IAAI,UAAW2D,MAAO,EAAGR,KAAK,6B,oCCnEnD,wIAgBe/K,IAhBA,CAGXO,OAAQ,0CAERiL,WAAY,oBACZC,YAAa,yCACbC,UAAW,kBACXC,cAAe,8BACf1L,SAAU,2EACVE,cAAe,CACb,6DACA,mEAMC,IAAMyL,EAAqB,CAChC,6DACA,0DACA,8CAGWC,EAAmB,CAC9B,8CAIWC,EAA2B,CACtC,gEACA,6DACA,8DAIWC,EAAyB,CACpC,0DACD,gEACA,+D,uSC9BC,IAAMC,EAAuB,CAC3BpB,MAAO,CACLqB,KAAM,CACJnE,SAAU,OACVL,MAAO,UACPyE,cAAe,UACf,gBAAiB,CACfzE,MAAO,YAGX0E,QAAS,CACP1E,MAAO,aA2BA2E,0BApBE,SAAC/L,GACd,IAAMgM,EAAY,e,EAAA,G,EAAA,UAAG,WAAOC,GAAP,eAAAC,EAAA,sEACDlM,EAAMmM,OAAOC,YAAY,CAAC3F,KAAM,OAAQ4F,KAAM,aAD7C,OACfC,EADe,OAEnBtM,EAAMuM,cAAcD,EAAMA,OAFP,0C,+KAAH,sDAIlB,OACI,kBAACE,EAAD,CAAYC,SAAUT,GACnBhM,EAAMmM,OACL,kBAAC,cACKR,GAGN,yBAAK3E,UAAU,0BAEjB,kBAAC0F,EAAA,EAAD,CAAQC,UAAW3M,EAAMmM,OAAQhF,QAAS6E,EAAc3E,QAAS,MAAjE,qBAQJmF,EAAazE,IAAO6E,KAAV,2EAAG7E,CAAH,6D,oECSChI,YAAagM,wBAxDH,SAAC/L,GAAW,IAAD,EACU0B,oBAAS,GAA9CmL,EAD2B,KACXC,EADW,OAEUpL,oBAAS,GAA9CqL,EAF2B,KAEXC,EAFW,OAGRtL,oBAAS,GAA5BpD,EAH2B,KAGpBqD,EAHoB,KAIlCS,qBAAU,WACN,GAAGpC,EAAMmM,SAAWY,EAAe,CACjC,IAAMA,EAAiB/M,EAAMmM,OAAOY,eAAe,CACjDE,QAAS,KACTC,SAAUC,eACVC,MAAO,CACLvD,MAAM,UAAW7J,EAAMyG,KAAlB,WACL4G,OAAQrN,EAAMmK,SAIlB4C,EAAeO,GAAG,SAAS,YAAiC,IAA/BC,EAA8B,EAA9BA,SAAUjB,EAAoB,EAApBA,O,2HAAoB,yBACzDiB,EAAS,WACTvN,EAAMuM,cAAcD,MAExBtM,EAAMO,YAAY,sBACdwM,EAAeF,gBACf,SAAC9D,GACC+D,IAAoB/D,MAEtB,SAACzK,GACCqC,YAAU,uCAAuCrC,KAEnD8L,IACAC,GAGF2C,EAAkBD,MAErB,CAAC/M,EAAMmM,SACV,IAAM9B,EAAU,SAAC/L,GACfmF,QAAQnF,MAAR,sBAAqCA,GACrCqC,YAAUrC,GACVqD,EAAS,kDAET,OAAO,6BACJrD,GAAS,kBAACgJ,EAAA,EAAD,CAAMF,MAAM,SAAS9I,GAC9BuO,GAAkBE,GAAmB,kBAAC,8BAAD,CACpCA,eAAgBA,EAChB/F,UAAU,uBACVuD,MAAO,CAGLiD,qBAAsB,CACpBvF,MAAO,OACPuC,OAAQ,gBAjDtB,I,oCCcMiD,EAAUC,iBA4HRC,EAAc,CAACC,WAAY,QAEpBtF,iBAvHU,SAACtI,GAAW,IAAD,EACJ0B,mBAAS,MAA9ByK,EADyB,KACjB0B,EADiB,OAEVnM,mBARJ,YAQXoM,EAFyB,KAEpBC,EAFoB,KAGzBnP,EAAO8C,mBAASsM,eAHS,KAINtM,mBAAS,MAA5BpD,EAJyB,KAIlBqD,EAJkB,OAKUD,mBAAS,IAA5CuM,EALyB,KAKVC,EALU,KAOhC9L,qBAAU,WACHI,OAAO2L,QACNN,EAAUrL,OAAO2L,OAAOV,IAExBW,KAEAC,SAASC,cAAc,cAAcC,iBAAiB,QAAQ,WAE1DV,EAAUrL,OAAO2L,OAAOV,IACxBW,SAIT,IAEH,IAAM/D,EAAU,SAAC7L,GACbmC,YAAU,iBAAiBnC,GAC3BmD,EAASnD,IAEP4P,EAAwB,WAC1BL,EA/BuC,OAgCvCS,YAAU,IAAIC,QAAM,SAAU,mBAC9BzO,EAAMO,YAAY,6BACd,WAAK,OAAOmO,YAAoB9P,EAAKoB,EAAM2O,gBAC3C,SAAA3Q,GACI,IAAGA,IAAMA,EAAE4Q,gBAIP,MAAMrQ,MAAM,yCAHZwP,EAtCR,QAuCQG,EAAiBlQ,KAKzBoM,IACAC,IAUFwE,EAAiB,SAACrQ,EAASsQ,GAC7BzE,EAAQ,mBAAmByE,IAEzBvC,EAAgB,SAACD,GAChBA,IACCyB,EA1DI,WA2DJ/N,EAAMO,YAAY,uBACd,WAAK,OAAO4L,EAAO4C,mBAAmBd,EAAce,oBAChD,CACI,eAAkB,CACdC,KAAM,CAAC3C,MAAOA,EAAM9E,IACpB0H,gBAAiB,CACb7C,KAAM,YAAcrM,EAAM2O,mBAM1C,SAAC3Q,GACMA,EAAEiQ,eAA4C,cAA3BjQ,EAAEiQ,cAAckB,QAvBlDpB,EAlDQ,WAmDRS,YAAU,IAAIC,QAAM,SAAU,oBAC9BzO,EAAMoP,UAAS,GAAM,IAwBFpR,EAAEM,MACDuQ,EAAe7Q,EAAEM,MAAM+Q,aAAcrR,EAAEM,MAAME,SAE7CqQ,MAIZzE,IACAC,KA+BZ,OAAO,yBAAK7C,GAAG,iBAAiB+C,MAAOoD,GAClCrP,GAAS,kBAACgJ,EAAA,EAAD,CAAMgI,IAAI,IAAItI,UAAU,eAAe1I,IAC/CA,GA5BY,WACd,OAAOwP,GACF,IA1F6D,YA0FzC,OAAQ,kBAACxG,EAAA,EAAD,CAAMgI,IAAI,IAAItI,UAAU,eAAxB,qBAC7B,IA3FgC,aA2FX,OAAO,kBAACiE,EAAA,EAAD,CAASC,MAAO,EAAGR,KAAK,uBACpD,IA7FI,UA6Fc,OAAO,KACzB,IA9FmC,MA+FnC,IA9FI,UA8Fc,OAAQ,6BACtB,kBAACO,EAAA,EAAD,CAASC,MAAO,EAAGR,KAAK,gCAE5B,IAnGA,OAmGkB,OAAO,yBAAK1D,UAAU,eACpC,kBAAC,iBAAD,CAAgBmF,OAAQA,GACpB,6BAIA,kBAAC,WAAD,KACA,kBAAC,EAAD,CAAUI,cAAeA,EAAeJ,OAAQ3J,OAAO2J,OACvD1F,KAAMzG,EAAM2O,YAAaxE,MAAOnK,EAAMuP,mBAK9C,IAjHU,WAkHV,QAAS,OAAO,kBAACtE,EAAA,EAAD,CAASC,MAAO,EAAGR,KAAK,iCAKjC8E,Q,kCC9InB,oDAcMC,GAdN,UAc8B1P,YAAa2P,aAPlB,SAAC1P,GAItB,OAHAoC,qBAAU,WACNpC,EAAM2P,mBAAmB3P,KAC1B,CAACA,EAAMsF,aACH,OAGyDhC,oBAAU,KAE/DmM,O,yDChBf,qIA0IMG,EAAe,CAACC,UAAW,aAAcC,QAAS,WAAYC,UAAW,QAASC,SAAU,QAEnFjQ,iBAvHA,SAACC,GACdyD,QAAQxF,IAAR,eAA4B+B,GADJ,MAEE0B,mBAAS,MAA5BpD,EAFiB,KAEVqD,EAFU,OAGMD,oBAAS,GAAhCuO,EAHiB,KAGRC,EAHQ,KAItB9N,qBAAU,WACHI,OAAO2N,QACNC,MAEL,IACH,IAhBI5I,EAgBE6C,EAAU,SAACgG,GACf5M,QAAQxF,IAAR,iBAA8BoS,GAC9B1P,YAAU,iBAAiB0P,GAC3B1O,EAAS,iDAEL2O,EAAU,WACd,GAAGtQ,EAAMuP,eAAiBgB,wBACxB,MAAO,CACL,CACE,KAAQ,OACR,SAAY,IACZ,YAAc,CAAC,cAAiBpD,eAChC,MAASoD,yBAGT,IAAO,KACP,SAAY,kBAGZ,GAAGvQ,EAAMuP,eAAiBiB,0BAC9B,MAAO,CACL,CACE,KAAQ,SACR,SAAY,IACX,YAAe,CAAC,cAAiBrD,eACjC,MAASqD,2BAGV,IAAO,KACP,SAAY,kBAIhB,MAAMjS,MAAM,8BAGV6R,EAAqB,WACzBD,OAAOM,QAAQ,CACbC,YAAa,SAAStS,EAAMuS,GAE1BlN,QAAQxF,IAAR,0BAAsCG,GACtC8R,GAAW,GACX,IAAIU,EAAK,CACPC,MAAO,CACL,eAAkB,UAEpBC,oBAAoB,CAIlB,oBAAsB,eAGxBC,eAAgB,CAAC,CACf,UAAa/Q,EAAM8B,KAAKlD,IACxB,YAAe,qBACf,gBAAmB,yBAEnByO,OAAQ,CAENlD,MAAOnK,EAAMuP,aACb,cAAiBpC,eACjB6D,UAAW,CACTC,WAAY,CAAC9G,MAAOnK,EAAMuP,aAAc2B,cAAe/D,kBAG3DgE,MAAOb,OAIX,OADA7M,QAAQxF,IAAR,wBAAoC2S,GAC7BD,EAAQS,MAAMC,OAAOT,IAE9BU,UAAW,SAASlT,EAAMuS,GAGxB,OAFAlN,QAAQxF,IAAR,wBAAqCG,GAE9BmT,YAAqBnT,EAAKoT,SAChCtS,MAAK,SAAAlB,GAGJ,GAFAyF,QAAQxF,IAAR,wBAAqCD,GACrCkS,GAAW,GACRlS,EAAEM,MACH,MAAMC,MAAM,8BAGVyB,EAAMoP,UAAS,GAAM,MAG1BqC,OAAM,SAAAzT,GACLkS,GAAW,GACX7F,EAAQrM,OAGZqM,QAAS,SAACgG,GACRhG,EAAQgG,MAETqB,OAAO,mBAGZ,OAAQ,yBAAKnH,MAAOqF,GACR,kBAAC,IAAD,CACEzP,OAAM,4CAnHhBqH,EAAKmK,sBACU,YAAhBC,gBAA2BpK,EAAKqK,0BACnCpO,QAAQxF,IAAR,eAA2B2T,cAA3B,cAAoDpK,GAC7CA,EAgHa,iBACNpH,OAAQgQ,IAET9R,GAAS,kBAAC,IAAD,CAAM8I,MAAM,SAAS9I,GAC/B,yBAAKkJ,GAAG,kBACPyI,GAAY,kBAAC,IAAD,CAAS/E,MAAO,EAAGR,KAAK,oC,gcCpIxCoH,EAAgB,SAAC9T,GAC1B,GAAGA,GAAKA,EAAE+K,OACN,OAAO/K,EAAE+K,OACP,GAAGgJ,MAAMC,QAAQhU,GACnB,OAAOA,EAAEuL,KAAI,SAAAvL,GAAC,OAAIA,EAAE+K,UAEpB,MAAM,IAAIxK,MAAJ,mCA0DP,IAAM0T,EAAe,SAAC5F,EAAM6F,EAAMlS,QAAe,IAAfA,MAAQ,IAEjD,IAAImS,EAAU,CACZC,SAAU,KAAMC,WAAY,MAE5B,OA9CyB,SAACC,EAASC,EAAWlG,EAAMmG,EAAaC,QAAkB,IAA/BD,MAAS,SAAsB,IAAlBC,MAAW,IAC1E,IAAIC,EAAM,YAAcF,EAAO,KAAKA,EAAS,IACzCG,EAAa,iBACVF,GAEDG,EAAQ,CACVvG,OACAwG,SAAUN,GAGZ,OAAOlS,KAAKG,OAAOsS,MAAMC,MAAM1B,OAAO,CAGpCuB,MAAOA,EACPF,SACArG,OACAwG,SAAUP,EACVU,YAAaT,EACbI,kBAECzT,KAAK4S,GA0BLmB,CAAY,uCAAwC,YAAa5G,EACxE,8BAA+BrM,GAE9Bd,MAAK,SAAAf,GAGF,OAFAgU,EAAQC,SAAWjU,EAAEqJ,GACrB2K,EAAQE,WAAalU,EAAE+U,YAChB7S,KAAKG,OAAO2S,QAAQ,CACzBC,KAAM,0BAA4BjV,EAAEqJ,GACpC6L,OAAQ,QACRb,OAAQ,CACNc,WAAY,QACZX,cAAe3S,EACfuT,WAAW,GAEbZ,cAAe3S,EACfuT,WAAW,EACXrB,YAGLhT,MAAK,SAAAlB,GACF,OAAOmU,MAMAqB,EAAoB,SAAC3K,EAAUmC,GACxC,IAAImH,EAAU,KACVsB,EAAmB,EACvB,OAAOpT,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAWqL,mBAAmBC,KAAK,CACpEhL,WAAUmC,iBACX9L,MAAK,SAAAlB,GACJyV,EAAmBzV,EAAE+K,OAAO6K,mBAAmBhR,OAC/C,IAAIkR,EAAW9V,EAAE+K,OAAO6K,mBAAmB3K,QAAO,SAAAjL,GAE9C,MAAmB,cAAZA,EAAE+V,SAEb5B,EAAU2B,EAASvK,KAAI,SAAAvL,GACnB,MAAO,CAAC6K,SAAU7K,EAAE6K,SAAUmC,aAAchN,EAAEgN,aAAcgJ,OAAQhW,EAAEgW,OAC9DxM,GAAIxJ,EAAEwJ,GAAIyM,KAAMjW,EAAEkW,kBAE9B,IAAIC,EAAS,KACb,GAAGL,GAAYA,EAASlR,OAAS,EAC7B,OAAOwR,QAAQC,IAAIP,EAASvK,KAAI,SAAC+K,EAAIjO,GAGjC,OAFA8N,EAASG,EAAGC,qBAAqBC,YAAYF,EAAGC,qBAAqBC,YAAY5R,OAAS,GAC1FuP,EAAQ9L,GAAGoO,OAASN,EAAOO,UAAUlN,GAC9BnH,KAAKG,OAAOsS,MAAMC,MAAM9T,IAAI,CAC/BwV,OAAQN,EAAOO,UAAUlN,GACzBkL,OAAQ,mCAIhB,MAAM,IAAInU,MAAM,yCAGrBW,MAAK,SAAA6T,GACJ,GAAGA,EAAM,CAOL,OAJAA,EAAMxJ,KAAI,SAACoL,EAAMtO,GACJ8L,EAAQ9L,GACVuO,UAAYD,EAAK5L,OAAO4J,cAAciC,aAE1C,CACHzC,UACAsB,yBAQDoB,EAAwB,SAAC9B,EAAO+B,EAAQC,GACnD,IAA+BC,EAAQ,KACnCC,EAASlC,EAAMxJ,KAAI,SAACoL,EAAMtO,GAE1B,OADA2O,EAAQF,EAAOI,eAAeP,EAAKnN,IAAIsN,EAAOH,EAAKnN,IAAImN,EAAKC,UACrD,CACH/L,SAAU8L,EAAK9L,SAAUmC,aAAc2J,EAAK3J,aAAcxD,GAAImN,EAAKnN,GACnE2N,WAAWJ,EAAiB,2BAA2B,aACvDK,WAAYJ,EACZK,cAAeL,MAGvB,OAAOZ,QAAQC,IACXY,EAAO1L,KAAI,SAACoL,EAAMtO,GACd,OAAOhG,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAWqL,mBAAmB0B,MAAMX,OAGjFzV,MAAK,SAAAlB,GACD,OAAG+W,EACQX,QAAQC,IACXtB,EAAMxJ,KAAI,SAACoL,EAAMtO,GACb,OAAOhG,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAWqL,mBAAmB2B,OAAO,CACtE1M,SAAU8L,EAAK9L,SAAUmC,aAAc2J,EAAK3J,aAAcxD,GAAImN,EAAKnN,SAKxExJ,KAGdkB,KAAK4S,IA8CK0D,EAAS,SAAC3M,EAAUmC,EAAcyK,EAAcpM,EAAOgF,EAAUuG,GAC5E,IAAIvG,EAAU,MAAM,IAAI9P,MAAJ,oDAEpB,IAAIoW,EAAO,GACX,OAAO1C,EAAa5I,EAAOgF,EAAU,CAACuG,YAAW/L,WAAUmC,eAAcyK,iBAAevW,MAAK,SAAAlB,GAGzF,OAFA2W,EAAKnN,GAAKxJ,EAAEoU,SAEL/R,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAWqL,mBAAmB8B,kBAC/D,CAAC7M,WAAUmC,eAAcxD,GAAIiO,EACzBE,eAAgB,CACZ,CACI,UAAahB,SAMhCzV,MAAK,SAAAlB,GACF,OAAOqC,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAWqL,mBAAmB4B,OAC/D,CAAC3M,WAAUmC,eAAcxD,GAAIiO,QAK1BG,EAAoB,SAAC/M,EAAUmC,EAAcyK,EAAcpM,EAAOgF,EAAUuG,GACvF,IAAIvG,EAAU,MAAM,IAAI9P,MAAJ,sDACpB,OAAO8B,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAWqL,mBAAmBiC,QAC/D,CAAChN,WAAUmC,eAAcxD,GAAIiO,IAC/BvW,MAAK,SAAAlB,GACH,OAAOwX,EAAO3M,EAAUmC,EAAcyK,EAAcpM,EAAOgF,EAAUuG,OAI9DkB,EAAmB,SAACC,GAC/B,OAAO1V,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAW8I,OAAzC,iBACA0E,IACJ7W,KAAK4S,IAYGkE,EAAa,WACxB,OAAO3V,KAAKG,OAAOkT,UAAUC,QAAQE,OACpC3U,KAAK4S,IAGKlJ,EAAgB,SAACC,EAAUC,EAAUmN,GAChD,OAAO5V,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAWsL,KAAK,CACjDhL,WACAC,SAAUA,GAAY,GACtBmN,cACD/W,KAAK4S,IAEGoE,EAA8B,SAACrN,EAAUmC,GACpD,OAAO3K,KAAKG,OAAOkT,UAAUC,QAAQpL,WAAWqL,mBAC/CC,KAAK,CAAChL,WAAUmC,iBAAe9L,KAAK4S,IAM1BqE,EAAe,SAACtN,GAC3B,OAAOxI,KAAKG,OAAOkT,UAAUC,QAAQyC,SAASvC,KAAK,CAAChL,aACnD3J,KAAK4S,K,i+FCrRV,IA6FexJ,eA7FU,SAACtI,GAAW,IAAD,EACoB0B,mBAAS,MAAtDkS,EADyB,KACLyC,EADK,KAEhCjU,qBAAU,WACNkU,MACD,IACH,IAAMA,EAAsB,e,EAAA,G,EAAA,UAAG,WAAO1X,GAAP,SAAAsN,EAAA,sDAC3BlM,EAAMO,YAAY,+CAClB,WAAK,OAAO2V,YAA4BlW,EAAM6I,SAAU7I,EAAMgL,iBAC9D,SAAAjC,GACI,KAAGA,EAAO6K,oBAAsB7K,EAAO6K,mBAAmBhR,OAAS,GAG/D,MAAM,IAAIrE,MAAJ,kCAA4CyB,EAAM6I,UAFxDwN,EAAsBtN,EAAO6K,mBAAmB3K,QAAO,SAAAC,GAAC,OAAIA,EAAEC,8BAKtEiB,IACApK,EAAMqK,SAXqB,0C,+KAAH,sDAatBkM,EAAe,SAAClQ,GAElB,IAAImQ,EAAO5C,EAAmBvN,GAC9BrG,EAAM+K,SAAS/K,EAAMwH,GAAI,CAACiO,aAAce,EAAKhP,GAAIyM,KAAMuC,EAAKtC,iBAE1DuC,EAAgB,SAACpQ,GAEnB,IAAImQ,EAAO5C,EAAmBvN,GAC9BrG,EAAM+K,SAAS/K,EAAMwH,GAAI,CAACiO,aAAce,EAAKhP,GAAIyM,KAAMuC,EAAKtC,cAAe2B,SAAS,KAqCxF,OAAO,kBAAC,IAAD,KACFjC,GAAsB,kBAAC,IAAO5L,IAAR,eAAYT,IAAI,eAAkB+C,KACpDsJ,EAAmBrK,KAAI,SAACmN,EAAQrQ,GAC7B,OAAO,yBAAKkB,IAAKmP,EAAOlP,GAAIR,UAAU,eArCxB,SAAC0P,EAAQrQ,GAC/B,MAAoB,YAAjBqQ,EAAO3C,OAAwC,QAAjB2C,EAAO3C,MAC7B,kBAAC,IAAM4C,SAAP,KACH,kBAACrP,EAAA,EAAD,CAAMN,UAAU,qBAAhB,8EACA,6BACA,kBAAC0F,EAAA,EAAD,CAAQlF,GAAInB,EAAGc,QAASoP,EAAcK,SAAO,GAA7C,aAGkB,yBAAjBF,EAAO3C,MACL,kBAAC,IAAM4C,SAAP,KACH,kBAACrP,EAAA,EAAD,CAAMN,UAAU,qBAAhB,iHAEA,6BACI,kBAAC0F,EAAA,EAAD,CAAQlF,GAAInB,EAAGc,QAASoP,EAAcK,SAAO,GAA7C,aAGc,cAAjBF,EAAO3C,MACL,kBAAC,IAAM4C,SAAP,KACP,kBAACrP,EAAA,EAAD,CAAMN,UAAU,qBAAhB,+GAEA,6BACA,kBAAC0F,EAAA,EAAD,CAAQlF,GAAInB,EAAGc,QAASsP,EAAeG,SAAO,GAA9C,yBAGsB,aAAjBF,EAAO3C,MACL,kBAAC,IAAM4C,SAAP,KACH,kBAACrP,EAAA,EAAD,CAAMN,UAAU,qBAAhB,iHAEI,6BACJ,kBAAC0F,EAAA,EAAD,CAAQlF,GAAInB,EAAGc,QAASoP,EAAcK,SAAO,GAA7C,kBALF,EAwBOC,CAAkBH,EAAQrQ,SAIrCuN,GAAsB,kBAAC,IAAO5L,IAAR,eAAYT,IAAI,WAAc+C,KAClD,kBAACW,EAAA,EAAD,CAASC,MAAO,EAAGR,KAAK,2C,gDCIrBoM,gBAAUxO,aA7EA,SAACtI,GAAW,IAAD,EACN0B,mBAAS,MAA5BpD,EADyB,KAClBqD,EADkB,OAEVD,mBAJY,UAI3BoM,EAFyB,KAEpBC,EAFoB,OAGArM,mBAAS,MAAlCmH,EAHyB,KAGfkO,EAHe,OAIQrV,mBAAS,MAA1CsJ,EAJyB,KAIXgM,EAJW,OAKItV,mBAAS,MAAtCuV,EALyB,KAKbC,EALa,KAQ1BC,EAAc,SAAC5P,EAAK6P,GAVX,QAWRtJ,EACCC,EAZ0B,qBAarBD,GACLiJ,EAAYK,EAAQvO,UACpBkF,EAfqD,8BAgBhDD,GACLkJ,EAAgBI,EAAQpM,cACxB+C,EAjBG,gCAkBED,IACLoJ,EAAcE,GACdrJ,EArBkF,cAsBlFsJ,EAAiBxO,EAAUmC,EAAcoM,EAAQ3B,aAAc2B,EAAQvB,WAKzEwB,EAAmB,SAACC,EAAKC,EAAMC,EAAK3B,GACvC,IAAI4B,EAAM5B,EAAQD,IAAkBJ,IACpCzH,EA7BuF,cA8BvF,IAAIM,EAAYqJ,YAAc1X,EAAM2X,KAAM3X,EAAM5B,KAAM4B,EAAMiI,MAAUjI,EAAM4X,KAAKvO,MAApD,WACxB,GAAO,EAAOvG,gBAAcC,SAAS4D,MAC1C3G,EAAMO,YAAY,oCAClB,SAACsX,GAAQ,OAAOJ,EAAIH,EAAKC,EAAMC,EAAKxX,EAAM4X,KAAKvO,MAAOgF,EAAUyJ,kBAA6B,IAArB9X,EAAM5B,KAAK2Z,UAAe,OAClG,SAAA/Z,GACK+P,EAlC+B,cAoCnC,SAAC/P,GACG,OAAgB,MAAbA,EAAEmR,OACE0G,EACO,yHAEA,uGAGJ7X,EAAEM,OAA6B,wCAApBN,EAAEM,MAAME,QACnB,iMAGI4L,YAAWpM,KAG1B2D,IAqBP,OAAO,kBAAC,IAAD,KACFrD,GAAS,kBAAC,IAAO0J,IAAR,eAAYT,IAAI,SAAY+C,KAAqB,kBAAChD,EAAA,EAAD,CAAMF,MAAM,aAAZ,UAAgC9I,KACzFA,GAAS,kBAAC,IAAO0J,IAAR,eAAYT,IAAKuG,GAASxD,KArBrB,WAEhB,OAAOwD,GACH,IAxD+B,UAwDd,OAAO,6BACpB,6BAAK,kBAACxG,EAAA,EAAD,CAAMF,MAAM,UAAUJ,UAAU,qBAAhC,YACL,6BAAK,kBAACM,EAAA,EAAD,CAAMN,UAAU,qBAAoB,uBAAGL,KAAMsQ,EAAWhD,KAAM+D,OAAO,UAAjC,yBAE7C,IA7DkF,aA6D9D,OAAO,kBAAC/M,EAAA,EAAD,CAASP,KAAK,gCACzC,IA7DG,cA6DkB,OAAO,kBAAC,EAAD,CAAkBnD,IA7D3C,cA6DgEC,GA7DhE,cA6DoFqB,SAAUA,EAAUmC,aAAcA,EAAc1M,MAAOA,EAC1I2Z,UAAWjY,EAAMiY,UAAWlN,SAAUoM,EAAa5T,YAAagI,IAAoBlB,QAAS1I,IACjG,IAhEqD,aAgEhC,OAAQ,kBAACuW,EAAA,EAAD,CACzB3Q,IAjEiD,aAiE5BC,GAjE4B,aAiERqB,SAAUA,EAAUkC,SAAUoM,EAAa7Y,MAAOA,EAC3F8K,cAAepJ,EAAM4X,KAAKvO,MAAOP,SAAU,IAC3CmP,UAAWjY,EAAMiY,UAAY1U,YAAagI,IAAoBlB,QAAS1I,IAC3E,IApE0B,SAqE1B,QAAS,OAAO,kBAACwW,EAAA,EAAD,CAAc5Q,IArEJ,SAqEoBC,GArEpB,SAqEmCuD,SAAUoM,EAAa5T,YAAagI,IAC7F0M,UAAWjY,EAAMiY,UAAW5N,QAAS1I,EAAUrD,MAAOA,KAKH8Z,U,mBCtBnEC,EAAQtZ,mBArEwB,UAsEhCsZ,EAAQ/Y,iBAxEsB,QAyE9B+Y,EAAQC,oBArEyB,WAsEjCD,EAAQE,eAnEe,OAoEvBF,EAAQG,sBAnEsB,IAoE9BH,EAAQI,iBAhEiB,QAiEzBJ,EAAQK,wBAlEwB,IAmEhCL,EAAQlL,aA/Da,MAgErBkL,EAAQM,aA9Da,OA+DrBN,EAAQO,eA9De,SA+DvBP,EAAQQ,UA7DU,WA8DlBR,EAAQS,UA7DU,WA8DlBT,EAAQU,UApDU,EAqDlBV,EAAQW,YApDY,EAqDpBX,EAAQY,qBAjBqB,CAACC,YAAa,EAAGC,UAAW,GAkBzDd,EAAQe,eAlDe,SAAC3S,GAAD,iBAAqBA,GAmD5C4R,EAAQgB,cAlDc,SAAC5S,GAAD,OAAaA,EAAb,SAmDtB4R,EAAQiB,cAlDc,SAAC7S,GAEN,OARG,GAyDpB4R,EAAQkB,gBA9CgB,SAAC9S,GAER,OAZS,GAyD1B4R,EAAQmB,iBA1CiB,SAACC,EAAQC,GAC9B,GApBkB,WAoBfD,EAAyB,CACxB,GAjCa,SAiCVC,EACC,OA3CkB,IA4ChB,GAlCS,WAkCNA,EACL,OA1CoB,SA4CtB,GA3BY,WA2BTD,EAAyB,CAC9B,GAvCa,SAuCVC,EACC,MAhDkB,OAiDhB,GAxCS,WAwCNA,EACL,MA9CoB,QAiD5B,MAAMnb,MAAM,kBAAkBkb,EAAnB,eAAwCC,IA6BvDrB,EAAQsB,gBA3BgB,SAACD,GACrB,MA/CmB,WA+CZA,GAhDU,SAgDoBA,GA6BzCrB,EAAQ3K,eAvEoB,6CAwE5B2K,EAAQ1G,oBAtEmB,mFAuE3B0G,EAAQxG,uBAxEuB,mFAyE/BwG,EAAQzG,YAtEY,OAuEpByG,EAAQ7H,wBArFwB,QAsFhC6H,EAAQ9H,sBA1FsB,OA2F9B8H,EAAQuB,cAxEc,SAyEtBvB,EAAQwB,cAxEc,U,mBCFtBC,EAAOzB,QA5Ba,CAChB0B,QAAS,UACTC,MAAO,OAAQC,KAAM,QACrBC,OAAQ,OAAQC,UAAU,UAAWC,UAAU,UAAWC,OAAO,OAAQC,MAAM,MAAOC,QAAQ,QAASC,OAAQ,OAAQC,MAAO,WAC9HC,SAAS,eAAiBC,gBAAiB,aAC3CC,MAAO,WAAYC,UAAW,OAAQC,WAAY,QAClDC,YAAY,aAAcC,aAAc,cAAeC,YAAa,aACpEC,aAAa,YAAaC,cAAe,aAAcC,aAAc,YAErEC,UAAW,YAAaC,MAAO,MAAOC,SAAU,SAChDC,EAAG,IAAKC,IAAK,MAAOC,IAAK,MAAOzP,GAAI,KACpC0P,UAAW,WAAYC,MAAO,OAAQC,MAAO,UAC7CC,KAAM,UAAWC,MAAO,YACxBC,QAAS,aAAcC,OAAQ,aAAcC,UAAW,aACxDC,QAAQ,aAAcC,SAAS,QAASC,OAAQ,YAAaC,QAAQ,OACrEC,QAAQ,WACRC,WAAY,GACZC,GAAI,EACJC,WAAY,aACZC,UAAW,c,kCCnBf,waAAMhf,EAAWC,EAAQ,QAEzBA,EAAQ,QAID,IA8CMgf,EAAY,SAAC7e,GAAD,OAAc,SAACC,GACpC,IAAGA,EAAEI,MAASJ,EAAEI,KAAK8W,eAAe,QAE9B,MAAGlX,EAAEI,KAAK8W,eAAe,QACD,iBAAhBlX,EAAEI,KAAKye,KACP,IAAIte,MAAMP,EAAEI,KAAKye,MAEjB,IAAIte,MAAM,yBAId,IAAIA,MAAM,wBAThBR,EAASC,EAAEI,QAYN0e,EAAkB,SAAC9e,GAC5B,GAAGA,EAAEI,OAASJ,EAAEI,KAAK8W,eAAe,QAChC,OAAOlX,EAAEI,KACP,MAAGJ,EAAEI,KAAK8W,eAAe,QACD,iBAAhBlX,EAAEI,KAAKye,KACP,IAAIte,MAAMP,EAAEI,KAAKye,MAEjB,IAAIte,MAAM,yBAId,IAAIA,MAAM,yBAGX6L,EAAa,SAACpM,GACvB,OAAGA,EAAE+K,QAAU/K,EAAE+K,OAAOzK,OACpBqC,YAAU,cAAc3C,EAAE+K,OAAOzK,MAAME,SAAW,GAC3CR,EAAE+K,OAAOzK,MAAME,SACjBR,EAAEM,OACPqC,YAAU,cAAc3C,EAAEM,OAAS,GAC5BN,EAAEM,OACJN,EAAEQ,SACPmC,YAAU,cAAc3C,EAAEQ,SAAW,GAC7BR,EAAEQ,SACQ,iBAANR,GACZ2C,YAAU,cAAc3C,GAAK,GAEtBA,IAEP2C,YAAU,qDAAqD,GAExD,2CAOFoc,EAAW,SAAC3d,GACrB,OAAOzB,EAASqf,YAAYC,cAAc,WAAnCtf,CAA+C,CAACyB,WAASF,KAAK4d,IAK5DI,EAAa,SAACvF,EAAMwF,GAC7B,OAAOxf,EAASqf,YAAYC,cAAc,aAAnCtf,CAAiD,CAACga,OAAMwF,aAAWje,KAAK4d,IAEtEM,EAAe,SAACxe,GACzB,OAAOjB,EAASqf,YAAYC,cAAc,eAAnCtf,CAAmD,CAACiB,SAElDye,EAAa,SAACje,EAAQuY,EAAM2F,EAAMC,GAC3C,OAAO5f,EAASqf,YAAYC,cAAc,aAAnCtf,CAAiD,CAACyB,SAAQuY,OAAM2F,OAAMC,UAAQre,KAAK4d,IAIjFU,EAAU,SAACpe,EAAQuY,EAAM4F,GAClC,OAAO5f,EAASqf,YAAYC,cAAc,UAAnCtf,CAA8C,CAACyB,SAAQuY,OAAM4F,UAAQre,KAAK4d,IAYxEpO,EAAsB,SAAC+O,EAAS9O,GACzC,OAAOhR,EAASqf,YAAYC,cAAc,sBAAnCtf,CAA0D,CAAC8f,UAAS9O,gBAC1EzP,KAAK4d,IAIGY,EAAsB,SAACD,EAAS9O,GACzC,OAAOhR,EAASqf,YAAYC,cAAc,sBAAnCtf,CAA0D,CAAC8f,UAAS9O,gBAC1EzP,KAAK4d,IAQGa,EAAgB,SAAChP,GAC1B,OAAOhR,EAASqf,YAAYC,cAAc,gBAAnCtf,CAAoD,CAACgR,gBAC3DzP,KAAK4d,IAGGc,EAAkB,SAACtR,EAAOuR,GACnC,OAAOlgB,EAASqf,YAAYC,cAAc,kBAAnCtf,CAAsD,CAAC2O,QAAOuR,OACpE3e,KAAK4d,IAIGvL,EAAuB,SAACC,EAASsM,GAC1C,OAAOngB,EAASqf,YAAYC,cAAc,uBAAnCtf,CAA2D,CAAC6T,UAASsM,oBAC3E5e,KAAK4d,K,uUC9EJiB,EAAS,CAACvT,OAAO,OAAQwT,SAAU,YACnCC,EAAe,CAACD,SAAU,WAAYE,MAAO,OAAQC,IAAK,MAAOC,UAAW,oBAWnEC,UA3EE,SAACre,GAAW,IAAD,EACE0B,mBAAS,MAA5B4c,EADiB,KACTC,EADS,OAEI7c,mBAAS,MAA9B8c,EAFiB,KAETC,EAFS,KAGxBhb,QAAQxF,IAAR,iBAA8B+B,GAC9BoC,qBAAU,WACNmc,EAAQ,CAACG,SAAUC,EAAKC,IAAM5e,EAAM5B,KAAKuZ,KAAM3X,EAAM6e,YAAa7e,EAAM5B,KAAK0gB,KAAM9e,EAAM5B,KAAKuZ,KAAK6G,UACnG,IAAI5G,EAAO5X,EAAM5B,KAAKuZ,KACtBoH,YAAgBnH,EAAK4G,QAAQtf,MAAK,SAAAlB,GAC7B4Z,EAAKoH,YACJpH,EAAKoH,WAAWzV,KAAI,SAAA0V,GACZjhB,EAAEihB,EAAIzX,IAAKyX,EAAIC,IAAIC,gBAAgBC,MAAMF,OAGrDT,EAAUzgB,MACXyT,OAAM,SAAAzT,GACDC,YAAI,kBAAmBD,QAE9B,IAMH,OAEI,kBAAC,IAAD,CAAeuM,MAAOwT,EAAQxW,IAAI,YAAYC,GAAG,YAAYR,UAAU,4BAGrE,kBAAC,IAAD,CAAQqC,MAAUrJ,EAAM5B,KAAKuZ,KAAKtO,MAArB,MAAgCrJ,EAAM5B,KAAKihB,KAAKC,aAAajW,MAA7D,eAGb,kBAAC,IAAD,iBAAUrJ,EAAM5B,KAAKuZ,KAArB,CACE4H,KAAMC,oBACNC,KAAMzf,EAAM5B,KAAKshB,OACjBC,YAAa3f,EAAM5B,KAAKuZ,KAAKiI,QAC7BX,IAfHjf,EAAM5B,KAAKuZ,KAAKkI,YAAoBL,oBAAYxf,EAAM5B,KAAKuZ,KAAKkI,YAAYV,gBAAgBW,MAAMZ,IAC9F,KAeDa,QAAS,uBAER/f,EAAM5B,KAAKuZ,KAAKqI,cAAgBhgB,EAAM5B,KAAKuZ,KAAKqI,aAAazW,KAAI,SAAA0W,GAChE,OAAGA,EAAEvV,KACI,2BAAIuV,EAAEvV,MAER,SAGX,kBAAC,IAAD,CAAelD,GAAG,eAAe0Y,UAAW,CAC1C,kBAAC,IAAD,CAAM3Y,IAAK,KAAM+H,IAAI,IAAIlI,MAAM,SAASK,SAAS,QAAjD,yCACA,kBAAC,IAAD,CAAMF,IAAK,KAAM+H,IAAI,IAAIlI,MAAM,SAASK,SAAS,QAAjD,iCACA,kBAAC,IAAD,CAAMF,IAAK,KAAM+H,IAAI,IAAIlI,MAAM,SAASK,SAAS,QAAjD,6BAEC6W,GAAUE,GAAW,kBAACF,EAAOI,SAAR,CACpBI,KAAM9e,EAAM5B,KAAKihB,KAAKC,aAAaa,QAAUngB,EAAM5B,KAAK0gB,KAAKK,gBAAgBW,MAAMZ,IACnFV,OAAQA,EACR4B,WAAYpgB,EAAMogB,cAElB9B,GAAUte,EAAM6e,aAAe,kBAAC,IAAD,CAASA,YAAa7e,EAAM6e,iBAsBzE,IAAMF,EAAO,SAACC,EAAMjH,EAAMkH,EAAaC,EAAMN,GAC3C,OAAO6B,IAASC,IAAI,CAClBC,QAAS,IACTrV,MAAO,EACPsV,OAAQ,CACN7I,KAAM,WAAK,OAAO8I,EAAQ9I,EAAK+I,UAGjCzQ,QAAS,SAACjQ,GACR,OAAIA,EAAM1B,OACRqC,YAAU,kCAAkCX,EAAM1B,MAAME,QAA/C,UAAgEwB,EAAM1B,MAAMqiB,OAAS,EAAM,GAC7F,kBAAC,IAAO3Y,IAAR,eAAYT,IAAI,kBAAmBgD,MAAO0T,GAE7C3T,KAEF,kBAAC,IAAD,KACA,kBAAC,IAAD,CAAO/C,IAAK,yBAA0BC,GAAI,yBAA0B8H,IAAI,IAAItI,UAAU,eAAtF,yIAIF,yBAAKA,UAAU,eAAc,uBAAGL,KAAK,eAAR,4BAItB,kBAAC,IAAOqB,IAAR,eAAYT,IAAI,oBAAoBC,GAAI,oBAAsB+C,MAAO0T,GAExE3T,KAEH,kBAAC,IAAD,KACA,kBAAC,IAAD,CAAS/C,IAAK,yBAA0BC,GAAI,yBAA0B6E,KAAK,YAAYzJ,OAAO,YAOnG8O,OAnCkB,SAmCXkP,EAAQ5gB,GASX,OAAO,kBAAC4e,EAAD,iBACC5e,EADD,CAEH2X,KAAMiJ,EAAOjJ,KAAKkJ,QAClBjJ,KAAMD,EACNkH,YAAaA,EACbiC,MAAOnJ,EAAKmJ,MACZV,WAAYpgB,EAAMogB,kBAOxBK,EAAU,SAAC9I,GACf,OAAOA,GACL,IAAK,aAAa,OAAO,sEACzB,IAAK,iBAAiB,OAAO,8GAC7B,IAAK,WAAW,OAAO,+DACvB,IAAK,8CAA8C,OAAO,sEAC1D,IAAK,sDAAsD,OAAO,sEAClE,QACE,MAAM,IAAIoJ,YAAY,mBAQfC,EAAS,c,6VC5HP1Y,iBAtCU,SAACtI,GAAW,IAAD,EACF0B,mBAAS,MAAhCiS,EADyB,KAChBsN,EADgB,KAGjC7e,qBAAU,WACT8e,MACE,IACF,IAAMA,EAAgB,e,EAAA,G,EAAA,UAAG,sBAAAhV,EAAA,sDACjBlM,EAAMO,YAAY,mBAAoByV,KAAY,SAAChY,GAC/C,GAAGA,EAAE2V,SAAW3V,EAAE2V,QAAQpK,IAAI,CAC1B,IAAIqB,EAAU5M,EAAE2V,QAAQpK,KAAI,SAAAmN,GACxB,MAAO,CAAC7M,MAAO6M,EAAOrK,KAAMlC,MAAOuM,EAAOlP,OAE9CyZ,EAAWrW,QAEX5K,EAAMqK,QAAQ,+BAEnBD,IAAYpK,EAAMqK,SAVJ,0C,+KAAH,qDAetB,OAAO,kBAAC,IAAD,KACFsJ,GAAW,kBAAC,IAAO3L,IAAR,eAAYT,IAAI,gBAAmB+C,KACvC,kBAAC,IAAD,CAAQ9C,GAAG,eAAeoD,QAAS+I,EAAS3M,UAAU,QACtD6D,YAAY,kBAAkB1D,QANrB,SAACK,EAAIsD,GACtB9K,EAAM+K,SAAS/K,EAAMwH,GAAI,CAACqB,SAAUiC,SAOlC6I,GAAW,kBAAC,IAAO3L,IAAR,eAAYT,IAAI,WAAc+C,KACnC,kBAAC,IAAD,CAASY,MAAO,EAAGR,KAAK,6B,kCCtCxC,qCAIMzK,GAJN,UAImB,SAACD,GAChBoC,qBAAU,WACN+e,MACD,IACH,IAAMA,EAAa,WAEjB,IAAIhhB,EAASkO,SAAS+S,cAAc,UACpCjhB,EAAOsG,KAAO,kBACdtG,EAAO+e,IAAMlf,EAAMG,OAGnBA,EAAOkhB,OAAS,SAACrjB,GAEVgC,EAAMI,QACHJ,EAAMI,OAAOpC,IAKvBqQ,SAAS6D,KAAKoP,YAAYnhB,IAG5B,OAAO,OAGXF,EAAWshB,UAAY,CACnBnhB,OAAQohB,IAAUC,KAClBthB,OAAQqhB,IAAUE,QAGPzhB","file":"component---src-templates-game-post-js-976f7c9f8c2d1f1b2d41.js","sourcesContent":["const firebase = require(\"firebase\");\r\n// Required for side-effects\r\nrequire(\"firebase/functions\");\r\nimport {log, sendError} from 'utilities/Measure.js';\r\n\r\n//const COLLECTION_PLAYERS = 'players', COLLECTION_EXAMS = 'exams';\r\nconst dbConfig = require('./../../../functions/dbConfig.js');\r\n\r\nexport const firestoreThen = (callback) => (e) => {\r\n    //delete returns nothing\r\n    log(`firestore inline then e`, e);\r\n    if(!e){\r\n        callback(null);\r\n    }else if(e.exists){\r\n        let r = e.data();\r\n        callback(r);\r\n    }else if(e.data && e.data.success){\r\n        callback(e.data.success);\r\n    }else if(e.error){\r\n        throw new Error(e.error.message);\r\n    }else{\r\n        throw new Error('No such record found');\r\n    }\r\n}\r\nexport const firestoreThenInline =  (e) => {\r\n    //e = {error: {message: 'test error'}};\r\n    //delete returns nothing\r\n    log(`firestore inline catch e`, e);\r\n    if(e.exists){\r\n        let r = e.data();\r\n        return r;\r\n    }else if(e.data && e.data.success){\r\n        return e.data.success;\r\n    }else if(e.error){\r\n        throw new Error(e.error.message);\r\n    }else{\r\n        throw new Error('No such record found');\r\n    }\r\n}\r\n\r\nexport const firestoreCatch = (e) => {\r\n   // log(`firestore catch e`, e);\r\n    if(typeof e === 'string'){\r\n      //  sendError(e);\r\n        return e;\r\n    }else if(e.error){\r\n        //sendError(e.error.message);\r\n        return e.error.message;\r\n    }else{\r\n       // throw new Error('No such record found');\r\n     //  sendError('No such record found');\r\n       return 'No such record found';\r\n    }\r\n}\r\n\r\nexport const getPlayer = (uid) => {\r\n    return firebase.firestore().collection(dbConfig.COLLECTION_PLAYERS).doc(uid).get()\r\n    .then(firestoreThenInline);\r\n}\r\n\r\n\r\nexport const getExam = (uid, examId) => {\r\n    return firebase.firestore().collection(dbConfig.COLLECTION_PLAYERS).doc(uid)\r\n                                .collection(dbConfig.COLLECTION_EXAMS).doc(examId).get();\r\n}\r\n\r\nexport const saveExam = (uid, examId, save) => {\r\n    return firebase.firestore().collection(dbConfig.COLLECTION_PLAYERS)\r\n                                .doc(uid)\r\n                                .collection(dbConfig.COLLECTION_EXAMS)\r\n                                .doc(examId).update({\r\n                                    save\r\n                                });\r\n}\r\n\r\nexport const deleteExam = (uid, examId) => {\r\n    return firebase.firestore()\r\n                    .collection(dbConfig.COLLECTION_PLAYERS)\r\n                    .doc(uid)\r\n                    .collection(dbConfig.COLLECTION_EXAMS)\r\n                    .doc(examId).delete()\r\n                    .then(e => {\r\n                        return firebase.firestore().collection(dbConfig.COLLECTION_PLAYERS).doc(uid).update({\r\n                            [`exams.${examId}`]: firebase.firestore.FieldValue.delete()\r\n                        })\r\n                    })\r\n}\r\n","import React, {useState, useEffect} from 'react';\r\nimport LoadScript from './../LoadScript'\r\nimport Subscribable from 'views/hoc/Subscribable';\r\nimport {log, sendError} from 'utilities/Measure.js';\r\n\r\n\r\nlet clientId = \"392303660392-if4osc2chaurcd8a5o6btcuud6r3rj91.apps.googleusercontent.com\";\r\n\r\nconst config = {\r\n    clientId: \"392303660392-if4osc2chaurcd8a5o6btcuud6r3rj91.apps.googleusercontent.com\",\r\n    scope: 'https://www.googleapis.com/auth/drive.file',\r\n    discoveryDocs: [\r\n      \"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\",\r\n      \"https://www.googleapis.com/discovery/v1/apis/classroom/v1/rest\",\r\n    ]\r\n};\r\n\r\nconst Gapi = (props) => {\r\n\r\n    const onLoad = (e) => {\r\n\r\n        gapi.load('client', () => {\r\n            props.doSubscribe('getGapi', ()=>{return gapi.client.init(config)},\r\n            (r)=>{\r\n              props.onApiInit('gapi');\r\n            },\r\n            e => {\r\n              sendError(`gapi client init rejected`);\r\n            },\r\n            (e)=>{\r\n              sendError(`gapi client onError called`)\r\n            })\r\n        });\r\n    }\r\n\r\n    return <LoadScript apiKey=\"cli\" script='https://apis.google.com/js/api.js' \r\n        onLoad={onLoad} />\r\n}\r\n\r\nexport default Subscribable(Gapi);","import React, {useEffect, useState} from 'react';\r\nimport styled from 'styled-components';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport firebase from 'firebase/app';\r\n//import '@firebase/testing';\r\nimport \"firebase/auth\";\r\nimport \"firebase/functions\";\r\n\r\n\r\nimport {Helmet} from 'react-helmet';\r\nimport {log} from 'utilities/Measure.js';\r\nimport { globalHistory } from \"@reach/router\";\r\nimport Text from 'views/Text/Text/v1/Text.js';\r\nimport GetGapi from './GetGapi';\r\nimport LoadScript from './../LoadScript';\r\nimport { navigate } from \"gatsby\";\r\nimport {cloudCatch} from 'apis/firebase/cloudFunctions';\r\nimport {getUrlHash, getUrl} from 'utilities/Format';\r\nimport IconButton from 'views/IconButton/v1/IconButton.js';\r\n\r\nimport config from './../config';\r\nimport './styles.css';\r\n\r\n\r\nconst signInOptions = [\r\n    {\r\n        provider: firebase.auth.TwitterAuthProvider.PROVIDER_ID\r\n    },\r\n    {\r\n        provider: firebase.auth.FacebookAuthProvider.PROVIDER_ID\r\n    }\r\n]\r\n\r\nconst getGoogleProvider = (permissions) => {\r\n    return {\r\n        provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,\r\n        scopes: permissions, \r\n        customParameters: {\r\n            // Forces account selection even when one account\r\n            // is available.\r\n            //access_type: 'offline',\r\n            'include_granted_scopes': true, \r\n            //prompt: 'select_account'\r\n          }\r\n    }\r\n}\r\n\r\nconst uiConfig = {\r\n    signInFlow: 'redirect',\r\n    callbacks: {}\r\n}\r\nconst URL_HASH = \"#signed-in\";\r\nconst TEMP_HASH = \"#signing-in\";\r\n//SignInHoc(AssignmentView, id, needsGoogle, needsGapi, permissions);\r\nconst SignInHoC = (View, redirectUrl, needsGoogle) => props => {\r\n    if(!props.doSubscribe){\r\n        throw Error(`SignInHoc must be wrapped by subscribable`);\r\n    }\r\n    const [error, setError] = useState(null);\r\n    const [isGapiReady, setIsGapiReady] = useState(false);\r\n     const [user, setUser] = useState(false);\r\n    const [uiInstance, setUiInstance] = useState(null);\r\n\r\n    const onAuthStateChanged = (user) => {\r\n        setUser(getUser(user))\r\n    }\r\n    useEffect(()=>{\r\n        return ()=>{\r\n            deleteUi(uiInstance || getUi());\r\n        }\r\n    }, \r\n    [uiInstance])\r\n    useEffect(()=>{\r\n        if(isSigningIn() && window.firebaseui){\r\n            showSignInUi();\r\n        }\r\n    }, [isGapiReady, user])\r\n    useEffect(()=>{\r\n        /*dont know why this needs to be here, but the ui doesn't show without it*/\r\n        window.firebase = firebase; \r\n        if(firebase.apps.length === 0){\r\n            \r\n            firebase.initializeApp(config);\r\n            if(globalHistory.location.hostname === 'localhost'){\r\n              //firebase.functions().useFunctionsEmulator(\"http://localhost:5001\");\r\n            }\r\n          }\r\n        if(window && window.gapi && !isGapiReady){\r\n            setIsGapiReady(true);\r\n        }\r\n        firebase.auth().onAuthStateChanged(onAuthStateChanged);\r\n        setFirebaseToWindow();\r\n    }, [])\r\n    const watchConnection = () => {\r\n        var connectedRef = firebase.database().ref(\".info/connected\");\r\n        connectedRef.on('value', function(connectedSnap) {\r\n            setConnected(connectedSnap.val() === true);\r\n        })\r\n    }\r\n    const setFirebaseToWindow = (ref) => {\r\n        window.firebase = firebase; \r\n    }\r\n\r\n    const onSignOut = () => {\r\n        return props.doSubscribe('signInOut', ()=>{return firebase.auth().signOut()},\r\n        e => {\r\n            //resetUi();\r\n            deleteUi(getUi());\r\n            navigate(getUrl()) \r\n            return {success: 'logged out'}\r\n        },\r\n        e => {\r\n            return {error: `failed to sign out.`}\r\n        },\r\n        setError);\r\n    }\r\n\r\n    const showSignInUi = (permissions, attempts = 0) => {\r\n        console.log(`SignIn  showSignInUi`, props);\r\n        let ui = getUi();\r\n        if(!ui){\r\n            try{\r\n                firebase.auth().setPersistence(firebase.auth.Auth.Persistence.NONE)\r\n                //firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION)\r\n                resetUi(ui)\r\n                uiConfig.signInSuccessUrl = redirectUrl + URL_HASH;\r\n                window.location = getUrl() + TEMP_HASH;\r\n                uiConfig.callbacks.signInSuccessWithAuthResult =  postSignIn;\r\n             //   uiConfig.callbacks.signInFailure = (e) => {log(`bughunt SignInHoc callback signInFailure`, e)};\r\n                startUi(permissions);\r\n            }catch(e){\r\n                if(attempts < 1){\r\n                    showSignInUi(permissions, attempts + 1);\r\n                }\r\n            }\r\n        }else{\r\n            navigate(getUrl() + TEMP_HASH);\r\n        }\r\n    }\r\n    const getUi = ()=>{\r\n       // if(!isMounted) return null;\r\n       let fui;\r\n       if(firebaseui){\r\n        fui = firebaseui.auth.AuthUI.getInstance(getUiId());\r\n       }\r\n       if(!fui){\r\n           fui = uiInstance;\r\n       }\r\n        return fui;\r\n    }\r\n    const deleteUi = (fui) =>{\r\n        setUiInstance(null);\r\n        if(fui) fui.delete();\r\n        \r\n    }\r\n    const resetUi = (fui) => {\r\n        setUiInstance(null);\r\n        if(fui) fui.reset();\r\n    }\r\n    const startUi = (permissions) => {\r\n       \r\n        let newfui = getUi();\r\n        if(!newfui){\r\n            \r\n            let a = firebase.auth();\r\n            newfui = new firebaseui.auth.AuthUI(firebase.auth(), getUiId());\r\n        }\r\n        let google = getGoogleProvider(permissions);\r\n        newfui.start('#' + getUiId(), {...uiConfig, \r\n            signInOptions: [google, ...needsGoogle?[]:signInOptions]\r\n        });\r\n    }\r\n    const postSignIn = (authResult) => {\r\n        if(window && window.gapi && window.gapi.client && authResult && authResult.credential){\r\n            gapi.client.setToken({access_token: authResult.credential.accessToken});\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    const isSigningIn = () => {\r\n        return getUrlHash() === TEMP_HASH;\r\n    }\r\n    const cancelSignIn = () => {\r\n        navigate(getUrl())\r\n    }\r\n    const isSignedIn = () => {\r\n     //   if(connected && firebase.apps.length > 0 && user) return true;\r\n        if(user) return true;\r\n        return false;\r\n        //return connected && firebase.apps.length > 0 && firebase.auth().currentUser;// && !explicitSignOut;\r\n    }\r\n    const deleteUser = () => {\r\n        let u = firebase.auth().currentUser;\r\n        if(u){\r\n            return ()=>{\r\n                return u.delete()\r\n            }\r\n        }\r\n    }\r\n    const onGapiIsReady = () => {\r\n        setIsGapiReady(true); //callApiOnGapiReady\r\n    }\r\n    const getUser = (u) => {\r\n        if(u){\r\n           //let u = user;\r\n            return {uid: u.uid, email: u.email, displayName: u.displayName, photoURL: u.photoURL, \r\n                phoneNumber: u.phoneNumber, createTime: u.metadata.creationTime, lastTime: u.metadata.lastSignInTime,\r\n                provider: u.providerData.reduce((agg, el, i)=>{\r\n                    return agg + `${i > 0?', ':''}${el.providerId}`;\r\n                }, '')}\r\n        }\r\n        return null;\r\n    }\r\n\r\n    const getUiId = () => { \r\n        return `firebaseui-auth-container`\r\n    }\r\n    return (\r\n            <SignInWrapper>\r\n                <Helmet>\r\n                    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://www.gstatic.com/firebasejs/ui/4.3.0/firebase-ui-auth.css\" />\r\n                </Helmet>\r\n                <GetGapi onApiInit={onGapiIsReady} />\r\n                <LoadScript onLoad={setFirebaseToWindow} \r\n                    script=\"https://www.gstatic.com/firebasejs/ui/4.3.0/firebase-ui-auth.js\"/>\r\n\r\n     \r\n                <StateBackground signingIn={isSigningIn()}>\r\n                    <StateView signingIn={isSigningIn()} className=\"bg-grad-pp\">\r\n                        <IconButton \r\n                            className=\"sign-in-close\"\r\n                            icon=\"icon-cross\"\r\n                            onInput={cancelSignIn}\r\n                            color=\"primary\"\r\n                            bgColor=\"black\"\r\n                        />\r\n                        \r\n                        {isSigningIn() && <div>\r\n                            <Text key=\"auth-message\" id=\"auth-message\" fontSize=\"remS\" className=\"inline\">\r\n                                By signing in, some of your personal information will be used for authentication.  \r\n                            </Text>\r\n                            <a href={'/privacy'} trget=\"_blank\">Read more here</a>\r\n                        </div>}\r\n                \r\n                        \r\n                        {error && <Text key=\"sign-error\" id=\"sign-error\"  className=\"text-center\" >error</Text>}\r\n                        {/* {!isOnline && <Text key=\"sign-offline\" id=\"sign-offline\"  className=\"text-center\" >you are offline</Text>} */}\r\n\r\n                        <div id={getUiId()} className=\"sign-in-wrapper\" />\r\n                    </StateView>\r\n                </StateBackground>\r\n                {isSignedIn() && <SignOutWrapper>\r\n                    <Text key=\"sign-out\" id=\"sign-out\" className=\"text-underline\" onInput={onSignOut} >sign out</Text>\r\n                </SignOutWrapper>}\r\n               {isGapiReady &&  <div className={`actionView ${isSignedIn()?'signedIn':'notSignedIn'}`}>\r\n               <View {...props} isSignedIn={isSignedIn()} user={user} doSignOut={onSignOut} deleteUser={deleteUser}\r\n                isGapiReady={isGapiReady} doSignIn={showSignInUi} \r\n                />\r\n                </div>}\r\n            \r\n            </SignInWrapper>\r\n    )\r\n}\r\n\r\n\r\nexport default SignInHoC;\r\n\r\nconst SignOutWrapper = styled.div`\r\n    position: fixed;\r\n    top:0px;\r\n    right:0px;\r\n    color: orange;\r\n`\r\n// height: 100%;\r\nconst SignInWrapper = styled.div`\r\n    text-align: center !important;\r\n\r\n`\r\nconst StateBackground = styled.div`\r\n    position: absolute;\r\n    top:0px;\r\n    bottom:0px;\r\n    left: 0px;\r\n    right:0px;\r\n    background-color: rgba(0,0,0,0.8);\r\n    transform: translateY(${props => props.signingIn?'0%':'-100%'});\r\n    transition: transform 1s ease-out;\r\n    z-index: ${props => props.theme.zUi};\r\n`\r\nconst StateView = styled.div`\r\n\r\n    width: 95%;\r\n    margin: auto;\r\n    margin-top:100px;\r\n    z-index: ${props => props.theme.zTop};\r\n    position: relative;\r\n    .sign-in-close{\r\n        position: absolute;\r\n        top: -25px;\r\n        left: 0px;\r\n    }\r\n`","import styled from 'styled-components';\r\n\r\nexport const List = styled.section`\r\n    padding-left: 0px;\r\n    margin-left: 0px;\r\n    text-align: left;\r\n    position: relative;\r\n    .nextPage{\r\n        position: absolute; \r\n        top:0px;\r\n        right:0px;\r\n   \r\n    }\r\n    ul{\r\n        margin: 0px auto 30px auto;\r\n    }\r\n`\r\n\r\nexport const ListItem = styled.div`\r\n   border-bottom: 2px solid white;\r\n   position:relative;\r\n\r\n   .item-text{\r\n       display: inline-block;\r\n       width: 70%;\r\n       position: relative;\r\n       top: 10px;\r\n   }\r\n`","import React, { useState, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {getCourseWork} from 'apis/firebase/gapiFunctions';\r\nimport SubscriptionHoC from 'views/hoc/Subscribable';\r\nimport Text from 'views/Text/Text/v1/Text';\r\nimport Loading from 'views/Loading/v1/Loading';\r\nimport IconButton from 'views/IconButton/v1/IconButton';\r\n import {List, ListItem} from './classroom.css.js';\r\n import {cloudCatch} from 'apis/firebase/cloudFunctions';\r\n import Select from 'views/Select/v2/Select';\r\n import {log} from 'utilities/Measure.js';\r\n import {AnimatePresence, motion} from 'framer-motion'; \r\nimport {ANIM_LAYOUT_OVERLAP} from 'game/tree/Animations.js';\r\n\r\nconst PAGE_SIZE = 10;\r\nconst SelectCourseWork = (props) => {\r\n    const [courseWork, setCourseWork] = useState(null);\r\n    const [nextPageToken, setNextPageToken] = useState(null);\r\n    useEffect(()=>{\r\n        handleGetCourseWork()\r\n    }, [])\r\n    const handleGetCourseWork =  () => {\r\n        props.doSubscribe('selectCourseWorkGetCoursework', \r\n            ()=>{return getCourseWork(props.courseId, props.pageSize || PAGE_SIZE, nextPageToken)},\r\n            result => {\r\n                if(result.nextPageToken || (nextPageToken && !result.nextPageToken)){ //if there are > 10 responses, will get token back\r\n                    setNextPageToken(result.nextPageToken); //if token exists, or if there was a token and now is undefined ie end of list\r\n                }\r\n                \r\n                if(result.courseWork){\r\n                    let date;\r\n                    let filteredCw = result.courseWork.filter(f => f.associatedWithDeveloper);\r\n                    if(props.filterByTitle){\r\n                        filteredCw = filteredCw.filter(f => {\r\n                            return f.title.indexOf(props.filterByTitle)  > -1;\r\n                        });\r\n                    }\r\n               \r\n                  \r\n                    setCourseWork(filteredCw.map(cw => {\r\n                       // let hrs = cw.dueTime.hours+10;\r\n                        let adj = (cw.dueTime.hours > 0 && cw.dueTime.hours < 14)?0:1;\r\n                        date = new Date(cw.creationTime); //date.toLocaleDateString()\r\n                        return {label: `Title: ${cw.title}, Due date: ${\r\n                            new Date(\r\n                                cw.dueDate.year,\r\n                                cw.dueDate.month-1,\r\n                                adj + cw.dueDate.day,\r\n                                cw.dueTime.hours\r\n                            ).toLocaleDateString()}`, value: cw.id}\r\n                    }));\r\n                }else{\r\n                    throw new Error(`no coursework found for course ${props.courseId}`);\r\n                }\r\n            },\r\n            cloudCatch,\r\n            props.onError\r\n        );\r\n    }\r\n    const handleSelect = (id, val) => {\r\n        props.onSelect(props.id, {courseId: props.courseId, courseWorkId: val});\r\n    }\r\n\r\n    return <AnimatePresence>\r\n        {courseWork && <motion.div key=\"courswork\" {...ANIM_LAYOUT_OVERLAP}>\r\n                <List>\r\n                <div style={{height: '50px'}}>\r\n                {nextPageToken && <IconButton className=\"nextPage\" icon=\"icon-circle-down\" fontSize=\"remL\" \r\n                    rotate=\"-90\" onInput={handleGetCourseWork} text=\"Next Page\"  />}\r\n                </div>\r\n                <Select id=\"selectcourseWork\" options={courseWork} className=\"block\" placeholder=\"Select coursework\" onInput={handleSelect} />\r\n            </List></motion.div>}\r\n        {!courseWork && <motion.div key=\"loading\" {...ANIM_LAYOUT_OVERLAP}>\r\n            <Loading key=\"loading\"  delay={0} text=\"Retrieving Courses\"/>\r\n        </motion.div>}\r\n    </AnimatePresence>\r\n}\r\n\r\nSelectCourseWork.propTypes = {\r\n    id: PropTypes.string,\r\n    course: PropTypes.string,\r\n    onSelect: PropTypes.func\r\n}\r\n\r\nexport default SubscriptionHoC(SelectCourseWork);","\r\n\r\n\r\n\r\n\r\n\r\nconst config = {\r\n   // driveApiKey: 'AIzaSyDAHDS9Ia7fjc7MRYyD6zyKdRGZeRSrwrI',\r\n    //fireAPI: fireAPI,\r\n    apiKey: 'AIzaSyDAHDS9Ia7fjc7MRYyD6zyKdRGZeRSrwrI',\r\n    //authDomain: \"mathstims-7d4bb.firebaseapp.com\",\r\n    authDomain: \"auth.stimsims.com\",\r\n    databaseURL: \"https://mathstims-7d4bb.firebaseio.com\",\r\n    projectId: \"mathstims-7d4bb\", //\"quests-2cb9a\",\r\n    storageBucket: \"mathstims-7d4bb.appspot.com\",\r\n    clientId: \"392303660392-if4osc2chaurcd8a5o6btcuud6r3rj91.apps.googleusercontent.com\",\r\n    discoveryDocs: [\r\n      \"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\",\r\n      \"https://www.googleapis.com/discovery/v1/apis/classroom/v1/rest\",\r\n    ]\r\n  };\r\n\r\nexport default config;\r\n\r\nexport const studentPermissions = [\r\n  \"https://www.googleapis.com/auth/classroom.courses.readonly\",\r\n  \"https://www.googleapis.com/auth/classroom.coursework.me\",\r\n  \"https://www.googleapis.com/auth/drive.file\" //Recommended\r\n]\r\n\r\nexport const drivePermissions = [\r\n  \"https://www.googleapis.com/auth/drive.file\"\r\n]\r\n\r\n//for mass marking\r\nexport const teacherCreatePermissions = [\r\n  \"https://www.googleapis.com/auth/classroom.coursework.students\",\r\n  \"https://www.googleapis.com/auth/classroom.courses.readonly\",\r\n  'https://www.googleapis.com/auth/classroom.rosters.readonly',\r\n // \"https://www.googleapis.com/auth/drive.file\"\r\n]\r\n\r\nexport const teacherMarkPermissions = [\r\n  \"https://www.googleapis.com/auth/drive.metadata.readonly\",\r\n \"https://www.googleapis.com/auth/classroom.coursework.students\",\r\n \"https://www.googleapis.com/auth/classroom.courses.readonly\",\r\n]\r\n\r\n\r\n/*\r\nIf you store restricted scope data on servers (or transmit), then you need to go through a security assessment. \r\n\r\nif you plan to access or use a type of user data that was not originally disclosed in your \r\nprivacy policy when a Google user initially authorized access, you must update your privacy policy \r\nand prompt the user to consent to any changes before you may access that data.\r\n\r\nOnly certain application types may access Restricted Scopes for each product.\r\nProductivity and educational applications (including task management, note taking, workgroup communications, \r\n  and classroom collaboration applications) that only use Restricted Scopes to handle Drive files \r\n  (or their metadata or permissions) via the application’s user interface\r\n\r\n  Limit your use of data to providing or improving user-facing features that are \r\n  prominent in the requesting application's user interface.\r\n\r\n  Only transfer the data to others if necessary to provide or improve user-facing features that are \r\n  prominent in the requesting application's user interface. \r\n\r\n  Don't allow humans to read the data\r\n\r\n   Applications accessing Restricted Scopes must demonstrate that they adhere to certain security practices. \r\n   These applications must pass an annual security assessment \r\nscope access:\r\n\"https://www.googleapis.com/auth/drive.file\" //Recommended\r\nhttps://www.googleapis.com/auth/drive.metadata restricted\r\n*/","\r\nimport React, {useEffect, useState} from 'react';\r\nimport {\r\n    CardElement,\r\n    StripeProvider,\r\n    Elements,\r\n    injectStripe,\r\n  } from 'react-stripe-elements';\r\nimport styled from 'styled-components';\r\nimport Button from 'views/Button/v1/Button.js';\r\nimport Text from 'views/Text/Text/v1/Text';\r\nimport {log} from 'utilities/Measure.js';\r\n  \r\n\r\n  \r\n  const CARD_ELEMENT_OPTIONS = {\r\n    style: {\r\n      base: {\r\n        fontSize: '18px',\r\n        color: '#424770',\r\n        letterSpacing: '0.025em',\r\n        '::placeholder': {\r\n          color: '#aab7c4',\r\n        },\r\n      },\r\n      invalid: {\r\n        color: '#9e2146',\r\n      },\r\n    },\r\n  };\r\n\r\n\r\n  //class _CardForm extends React.Component<InjectedProps> {\r\nconst CardForm = (props) => {\r\n    const handleSubmit = async (ev) => {\r\n      let token = await props.stripe.createToken({type: 'card', name: 'stimsims'});\r\n      props.handlePayment(token.token);\r\n    };\r\n    return (\r\n        <CardStyles onSubmit={handleSubmit}>\r\n          {props.stripe ? (\r\n            <CardElement\r\n              {...CARD_ELEMENT_OPTIONS}\r\n            />\r\n          ) : (\r\n            <div className=\"StripeElement loading\" />\r\n          )}\r\n          <Button disabled={!props.stripe} onInput={handleSubmit} bgColor={'g3'}>Pay with Card</Button>\r\n        </CardStyles>\r\n      );\r\n  }\r\n\r\n\r\nexport default injectStripe(CardForm);\r\n\r\nconst CardStyles = styled.form`\r\n  border-top: 2px solid grey;\r\n  border-bottom: 2px solid grey;\r\n`","import React, {useEffect, useState} from 'react';\r\nimport {PaymentRequestButtonElement, injectStripe} from 'react-stripe-elements';\r\nimport Subscribable from 'views/hoc/Subscribable';\r\nimport {log, sendError} from 'utilities/Measure.js';\r\nimport {STRIPE_API_KEY, PAY_CURRENCY} from 'cloudFunctions/dbConfig.js';\r\nimport {cloudCatch} from 'apis/firebase/cloudFunctions';\r\nimport Text from 'views/Text/Text/v1/Text';\r\n\r\nconst PaymentRequestForm = (props) => {\r\n    const [canMakePayment, setCanMakePayment] = useState(true);\r\n    const [paymentRequest, setPaymentRequest] = useState(false);\r\n    const [error, setError] = useState(false);\r\n    useEffect(()=>{\r\n        if(props.stripe && !paymentRequest){\r\n          const paymentRequest = props.stripe.paymentRequest({\r\n            country: 'AU',\r\n            currency: PAY_CURRENCY,\r\n            total: {\r\n              label: `Stripe ${props.type} payment`,\r\n              amount: props.value,\r\n            },\r\n          });\r\n      \r\n          paymentRequest.on('token', ({complete, token, ...data}) => {\r\n            complete('success');\r\n            props.handlePayment(token);\r\n          });\r\n        props.doSubscribe('stripeButtonPayment',\r\n            paymentRequest.canMakePayment,\r\n            (result) => {\r\n              setCanMakePayment(!!result);\r\n            },\r\n            (error) => {\r\n              sendError(`PayementButton canMakePayment error ${error}`);\r\n            },\r\n            cloudCatch,\r\n            onError\r\n          )\r\n\r\n          setPaymentRequest(paymentRequest);\r\n        }\r\n    }, [props.stripe])\r\n    const onError = (error) => {\r\n      console.error(`stripe button error`, error);\r\n      sendError(error);\r\n      setError('There was a problem loading the stripe button')\r\n    }\r\n      return <div>\r\n        {error && <Text color=\"error\">{error}</Text>}\r\n        {canMakePayment && paymentRequest &&  <PaymentRequestButtonElement\r\n          paymentRequest={paymentRequest}\r\n          className=\"PaymentRequestButton\"\r\n          style={{\r\n            // For more details on how to style the Payment Request Button, see:\r\n            // https://stripe.com/docs/elements/payment-request-button#styling-the-element\r\n            paymentRequestButton: {\r\n              theme: 'dark',\r\n              height: '48px',\r\n            },\r\n          }}\r\n        />\r\n      }\r\n      </div>\r\n  }\r\n  export default Subscribable(injectStripe(PaymentRequestForm));","import React, {useEffect, useState} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {\r\n    StripeProvider,\r\n    Elements,\r\n} from 'react-stripe-elements';\r\n\r\nimport CardForm from './../CardForm/index';\r\nimport PaymentButton from './../PaymentButton/index';\r\nimport Loading from 'views/Loading/v1/Loading';\r\nimport Text from 'views/Text/Text/v1/Text';\r\nimport Button from 'views/Button/v1/Button';\r\n\r\nimport {createPaymentIntent, cancelPaymentIntent, cloudCatch} from 'apis/firebase/cloudFunctions';\r\n\r\nimport SubscriptionHoC from 'views/hoc/Subscribable';\r\nimport {getUid} from 'utilities/Uid';\r\n//import {handlePaymentCall} from './../api';\r\nimport {sendEvent, log, sendError} from 'utilities/Measure.js';\r\nimport {Event} from 'utilities/Create.js';\r\nimport {STRIPE_API_KEY} from 'cloudFunctions/dbConfig.js';\r\n\r\nconst API_KEY = STRIPE_API_KEY;\r\nconst FSM_NO_STRIPE = 'nostripe', \r\nFSM_COLLECT='coll', \r\n    FSM_SUCCESS=\"success\", FSM_WAIT_FOR_SIGNAL='wfs', //prevents cancelling payment if seperate from loading \r\n    FSM_LOADING='loading', FSM_CANCELLING = 'cancelling', FSM_CANCELLED = 'cancelled';\r\n\r\n\r\nconst MyStripeProvider = (props) => {\r\n    const [stripe, setStripe] = useState(null);\r\n    const [fsm, setFsm] = useState(FSM_NO_STRIPE);\r\n    const [uid] = useState(getUid());\r\n    const [error, setError] = useState(null);\r\n    const [paymentIntent, setPaymentIntent] = useState({});\r\n\r\n    useEffect(()=>{\r\n        if(window.Stripe){\r\n            setStripe(window.Stripe(API_KEY));\r\n            //call payment intents\r\n            onCreatePaymentIntent()\r\n        }else{\r\n            document.querySelector('#stripe-js').addEventListener('load', () => {\r\n                // Create Stripe instance once Stripe.js loads\r\n                setStripe(window.Stripe(API_KEY));\r\n                onCreatePaymentIntent();\r\n            });\r\n        }\r\n        \r\n    }, []);\r\n\r\n    const onError = (message) => {\r\n        sendError(`stripe error: ${message}`);\r\n        setError(message);\r\n    }\r\n    const onCreatePaymentIntent = () => {\r\n        setFsm(FSM_WAIT_FOR_SIGNAL);\r\n        sendEvent(new Event('stripe', 'payment-create'));\r\n        props.doSubscribe('stripeCreatePaymentIntent',\r\n            ()=>{return createPaymentIntent(uid, props.paymentType)},\r\n            e => {\r\n                if(e  && e.paymentIntentId){\r\n                    setFsm(FSM_COLLECT);\r\n                    setPaymentIntent(e);\r\n                }else{\r\n                    throw Error(`There was a problem with that payment`);\r\n                }\r\n            },\r\n            cloudCatch,\r\n            onError\r\n        )\r\n    }\r\n    const onPaymentSuccess = () => {\r\n        //setPaymentIntent(null);\r\n        //paymentIntent.fsm = FSM_SUCCESS;\r\n        setFsm(FSM_SUCCESS);\r\n        sendEvent(new Event('stripe', 'payment-success'));\r\n        props.onAccess(true, true);\r\n    }\r\n    const onPaymentError = (message, code) => {\r\n        onError(`Payment failed: ${code}`);\r\n    }\r\n    const handlePayment = (token) => {\r\n        if(token){\r\n            setFsm(FSM_LOADING);\r\n            props.doSubscribe('stripeHandlePayment', \r\n                ()=>{return stripe.confirmCardPayment(paymentIntent.paymentIntentSecret, \r\n                    {\r\n                        'payment_method': {\r\n                            card: {token: token.id},\r\n                            billing_details: {\r\n                                name: 'Stimsims ' + props.paymentType\r\n                            }\r\n                        }\r\n                    }\r\n                )\r\n                },\r\n                (e) => {\r\n                    if(e.paymentIntent && e.paymentIntent.status === 'succeeded'){\r\n                        onPaymentSuccess();\r\n                    }else{\r\n                        if(e.error){\r\n                            onPaymentError(e.error.decline_code, e.error.message);\r\n                        }else{\r\n                            onPaymentError('there was a problem, this payment cannot be completed');\r\n                        }\r\n                    }\r\n                },\r\n                cloudCatch,\r\n                onError\r\n            )\r\n        }\r\n    }\r\n\r\n    const renderFsm = () => {\r\n        switch(fsm){\r\n             case FSM_CANCELLED: return  <Text tag=\"p\" className=\"text-center\">Payment cancelled</Text>\r\n            case FSM_CANCELLING: return <Loading delay={0} text=\"Cancelling Payment\"/>\r\n            case FSM_SUCCESS: return null;\r\n            case FSM_WAIT_FOR_SIGNAL:\r\n            case FSM_LOADING: return  <div>\r\n                <Loading delay={0} text=\"Talking to Stripe Payments\"/>\r\n            </div>\r\n            case FSM_COLLECT: return <div className=\"text-center\">\r\n                <StripeProvider stripe={stripe}>\r\n                    <div>\r\n                    {/* <Elements>\r\n                    <PaymentButton handlePayment={handlePayment} type={props.paymentType} value={props.paymentValue}/>\r\n                    </Elements> */}\r\n                    <Elements>\r\n                    <CardForm handlePayment={handlePayment} stripe={window.stripe}\r\n                    type={props.paymentType} value={props.paymentValue} />\r\n                    </Elements>\r\n                    </div>\r\n                </StripeProvider>\r\n            </div>\r\n            case FSM_NO_STRIPE:\r\n            default: return <Loading delay={0} text=\"Waiting for Stripe Payments\"/>\r\n        }\r\n    }\r\n    return <div id=\"stripe-wrapper\" style={styleStripe}>\r\n        {error && <Text tag=\"p\" className=\"text-center\">{error}</Text>}\r\n        {!error && renderFsm()}\r\n    </div>\r\n  }\r\n\r\n  const styleStripe = {paddingTop: '20px'}\r\n\r\nexport default SubscriptionHoC(MyStripeProvider);\r\n\r\nMyStripeProvider.propTypes = {\r\n    onAccess: PropTypes.func.isRequired,\r\n    eventId: PropTypes.string.isRequired\r\n}","import React, {useState, useEffect, useRef} from 'react';\r\nimport styled from 'styled-components'\r\nimport SignIn from 'apis/SignIn/SignIn';\r\nimport Subscribable from 'views/hoc/Subscribable/index.js';\r\nimport {getUrl, getHost, getFullUrl} from 'utilities/Format.js';\r\nimport {log} from 'utilities/Measure';\r\n\r\nconst NestedSignInView = (props) => {\r\n    useEffect(()=>{\r\n        props.recieveSignInProps(props);\r\n    }, [props.isSignedIn])\r\n    return null;\r\n}\r\n\r\nconst AuthenticatedExamView = Subscribable(SignIn(NestedSignInView, getUrl(), false));\r\n\r\nexport default AuthenticatedExamView;\r\n\r\n","import React, {useEffect, useState} from 'react';\r\nimport {Helmet} from 'react-helmet';\r\nimport Subscribable from 'views/hoc/Subscribable';\r\nimport Text from 'views/Text/Text/v1/Text';\r\nimport {cloudCatch} from 'apis/firebase/cloudFunctions';\r\nimport {log, sendError} from 'utilities/Measure';\r\nimport {PAYPAL_SANDBOX_API_KEY, PAYPAL_LIVE_API_KEY, PAY_CURRENCY, PAYPAL_MODE,\r\n  PAY_REPORT_VALUE_PAYPAL, PAY_EXAM_VALUE_PAYPAL} from 'cloudFunctions/dbConfig.js';\r\n  import {capturePaypalPayment} from 'apis/firebase/cloudFunctions';\r\nimport LoadScript from './../LoadScript';\r\nimport {isDevelopment} from 'utilities/Validation';\r\nimport Loading from 'views/Loading/v1/Loading';\r\n\r\n  const getClientId = () => {\r\n    let id = PAYPAL_LIVE_API_KEY;\r\n    if(PAYPAL_MODE === 'sandbox') id = PAYPAL_SANDBOX_API_KEY;\r\n    console.log(`paypal mode ${PAYPAL_MODE} client id ${id}`);\r\n    return id;\r\n  }\r\n  //TODO refund wrong values immedietly, handle errors\r\n \r\nconst Paypal = (props) => {\r\n  console.log(`Paypal props`, props);\r\n  const [error, setError] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n    useEffect(()=>{\r\n        if(window.paypal){\r\n            renderPaypalButton();\r\n        }\r\n    }, []);\r\n    const onError = (err) => {\r\n      console.log(`paypal onError`, err);\r\n      sendError(`paypal error: ${err}`);\r\n      setError(`There was a problem processing that payment.`)\r\n    }\r\n    const getItem = () => {\r\n      if(props.paymentValue === PAY_EXAM_VALUE_PAYPAL){\r\n        return [\r\n          {\r\n            \"name\": 'exam',\r\n            \"quantity\": \"1\",\r\n            \"unit_amount\":{\"currency_code\": PAY_CURRENCY, \r\n            \"value\": PAY_EXAM_VALUE_PAYPAL\r\n          },\r\n           // \"tax\": \"0\",\r\n            \"sku\": \"e2\",\r\n            \"category\": \"DIGITAL_GOODS\"\r\n          }\r\n        ];\r\n      }else if(props.paymentValue === PAY_REPORT_VALUE_PAYPAL){\r\n        return [\r\n          {\r\n            \"name\": 'report',\r\n            \"quantity\": \"1\",\r\n             \"unit_amount\": {\"currency_code\": PAY_CURRENCY, \r\n             \"value\": PAY_REPORT_VALUE_PAYPAL\r\n            },\r\n           // \"tax\": \"0\",\r\n            \"sku\": \"r1\",\r\n            \"category\": \"DIGITAL_GOODS\"\r\n          }\r\n        ]\r\n      }else{\r\n        throw Error(`Paypal invalid item error`)\r\n      }\r\n    }\r\n    const renderPaypalButton = () => {\r\n      paypal.Buttons({\r\n        createOrder: function(data, actions) {\r\n          // This function sets up the details of the transaction, including the amount and line item details.\r\n          console.log(`paypal createOrder data`,data);\r\n          setLoading(true);\r\n          let pp = {\r\n            payer: {\r\n              \"payment_method\": \"paypal\"\r\n              },\r\n            application_context:{\r\n              // \"locale\":\"fi-FI\",\r\n              // \"brand_name\":\"PawelBiernackiSklep\",\r\n              // \"landing_page\":\"login\",\r\n              \"shipping_preference\":\"NO_SHIPPING\",\r\n             // \"user_action\":\"commit\"\r\n            },\r\n            purchase_units: [{\r\n              \"custom_id\": props.user.uid,\r\n              \"description\": \"report description\",\r\n              \"soft_descriptor\": \"report soft_descriptor\",\r\n            //  \"payment_instruction\": 'the address is unneccessary',\r\n              amount: {\r\n               // value: '0.01'\r\n                value: props.paymentValue,\r\n                \"currency_code\": PAY_CURRENCY,\r\n                breakdown: {\r\n                  item_total: {value: props.paymentValue, currency_code: PAY_CURRENCY}\r\n                }\r\n              },\r\n              items: getItem()\r\n            }]\r\n          };\r\n          console.log(`paypal createOrder pp`,pp);\r\n          return actions.order.create(pp);\r\n        },\r\n        onApprove: function(data, actions) {\r\n          console.log(`paypal onApprove data`, data);\r\n          \r\n          return capturePaypalPayment(data.orderID)\r\n          .then(e => {\r\n            console.log(`paypal onApprove then`, e);\r\n            setLoading(false);\r\n            if(e.error){\r\n              throw Error(`Unable to complete payment`);\r\n            }else{\r\n                //throw Error(`test error`) //displayed error message appropriately,\r\n                props.onAccess(true, true);\r\n            }\r\n          })\r\n          .catch(e => {\r\n            setLoading(false);\r\n            onError(e);\r\n          });\r\n        },\r\n        onError: (err) => {\r\n          onError(err);\r\n        }\r\n      }).render('#paypal-button');\r\n    }\r\n\r\n    return  <div style={stylesPaypal}>\r\n                <LoadScript \r\n                  script={`https://www.paypal.com/sdk/js?client-id=${getClientId()}&currency=AUD`}\r\n                  onLoad={renderPaypalButton} \r\n                />\r\n                {error && <Text color=\"error\">{error}</Text>}\r\n                <div id=\"paypal-button\"></div>\r\n                {loading &&  <Loading delay={0} text=\"Talking to Paypal payments\"/>}\r\n            </div>\r\n}\r\n\r\nconst stylesPaypal = {borderBox: 'border-box', padding: '20px 0px', maxHeight: '400px', overflow: 'auto'}\r\n\r\nexport default Subscribable(Paypal);","import {log} from 'utilities/Measure.js';\r\n\r\nexport const classroomThen = (e) => {\r\n    if(e && e.result){\r\n        return e.result;\r\n    }else if(Array.isArray(e)){\r\n        return e.map(e => e.result);\r\n    }else{\r\n        throw new Error(`malformed classroomThen result`);\r\n    }\r\n    \r\n}\r\nexport const classroomCatch= (e) => {\r\n   // throw new Error(e.result);\r\n   return e.result;\r\n}\r\nexport const getFiles = (fileIds) => {\r\n    return Promise.all(fileIds.map(e => {\r\n        return gapi.client.drive.files.get({\r\n            fileId: e,\r\n            fields: 'name, properties, appProperties'\r\n          })\r\n          .then(classroomThen);\r\n    }))\r\n}\r\nexport const createAFile = (docType, mediaType, name, params = '', appProps = {}) => {\r\n    let fields = `id, name${params?`, ${params}`:''}`;\r\n    let appProperties = {\r\n        ...appProps\r\n    }\r\n      var media = {\r\n        name,\r\n        mimeType: mediaType,\r\n       // body: body\r\n      };\r\n      return gapi.client.drive.files.create({\r\n        // resource: fileMetadata,\r\n        //invalid fields: content\r\n        media: media,\r\n        fields,\r\n        name,\r\n        mimeType: docType,\r\n        contentType: mediaType,\r\n        appProperties\r\n       // body: 'hello, world, omg'\r\n      }).then(classroomThen);\r\n}\r\nexport const createFolder = (name) => {\r\n    let fileMetadata = {\r\n        'name': name,\r\n        'mimeType': 'application/vnd.google-apps.folder'\r\n      };\r\n      return gapi.client.drive.files.create({\r\n        resource: fileMetadata,\r\n        fields: 'id, alternateLink'\r\n      }).then(classroomThen);\r\n}\r\nexport function listFiles() {\r\n  gapi.client.drive.files.list({\r\n    'pageSize': 10,\r\n    'fields': \"nextPageToken, files(id, name)\"\r\n  }).then(classroomThen);\r\n}\r\n\r\n\r\n//chartId:1216131842\r\nexport const createReport = (name, body, props = {}) => {\r\n//Goal: create document and get the weblink\r\nlet results = {\r\n  reportId: null, reportLink: null\r\n}\r\n  return createAFile('application/vnd.google-apps.document', 'text/html', name, \r\n  'webViewLink, webContentLink', props//, {gamegrade: '80'}\r\n  )\r\n  .then(r => {\r\n      results.reportId = r.id;\r\n      results.reportLink = r.webViewLink;\r\n      return gapi.client.request({\r\n        path: '/upload/drive/v3/files/' + r.id,\r\n        method: 'PATCH',\r\n        params: {\r\n          uploadType: 'media',\r\n          appProperties: props,\r\n          published: true\r\n        },\r\n        appProperties: props,\r\n        published: true,\r\n        body\r\n      })\r\n  })\r\n  .then(e => {\r\n      return results;\r\n  })\r\n  //.then(classroomThen)\r\n}\r\n\r\n\r\nexport const lookAtAssignments = (courseId, courseWorkId) => {\r\n    let results = null;\r\n    let totalAssignments = 0;\r\n    return gapi.client.classroom.courses.courseWork.studentSubmissions.list({\r\n        courseId, courseWorkId\r\n    }).then(e => {\r\n        totalAssignments = e.result.studentSubmissions.length;\r\n        let filtered = e.result.studentSubmissions.filter(e => {\r\n            // && e.assignmentSubmission.attachments && e.assignmentSubmission.attachments.length > 0\r\n            return e.state === 'TURNED_IN';\r\n        });\r\n        results = filtered.map(e => {\r\n            return {courseId: e.courseId, courseWorkId: e.courseWorkId, userId: e.userId, \r\n                    id: e.id, link: e.alternateLink}\r\n        });\r\n        let latest = null;\r\n        if(filtered && filtered.length > 0){\r\n            return Promise.all(filtered.map((ss, i) => {\r\n                latest = ss.assignmentSubmission.attachments[ss.assignmentSubmission.attachments.length - 1];\r\n                results[i].fileId = latest.driveFile.id;\r\n                return gapi.client.drive.files.get({\r\n                    fileId: latest.driveFile.id,\r\n                    fields: 'appProperties, webViewLink'\r\n                })\r\n            }));\r\n        }else{\r\n            throw new Error('no assignments have been turned in')\r\n        }\r\n        //return {error: 'no assignments have been turned in'};\r\n    }).then(files => {\r\n        if(files){ //can be null of no student responses are in a turned in state\r\n            //map properties to makea workable object ofr markGradedAssignments\r\n            let result = null;\r\n            files.map((file, i) => {\r\n                result = results[i];\r\n                result.gameGrade = file.result.appProperties.gameGrade;\r\n            })\r\n            return {\r\n                results,\r\n                totalAssignments\r\n            };\r\n        }\r\n    })\r\n    //last section is not an api call\r\n    //.then(classroomThen)\r\n  }\r\n  \r\n  export const markGradedAssignments = (files, grades, returnAssignment) => {\r\n    let studentSubmissions = null, grade = null;\r\n    let mapped = files.map((file, i) => {\r\n        grade = grades.hasOwnProperty(file.id)?grades[file.id]:file.gameGrade;\r\n        return {\r\n            courseId: file.courseId, courseWorkId: file.courseWorkId, id: file.id,\r\n            updateMask:returnAssignment?'draftGrade,assignedGrade':'draftGrade',\r\n            draftGrade: grade,\r\n            assignedGrade: grade,\r\n        }\r\n    })\r\n    return Promise.all(\r\n        mapped.map((file, i) => {\r\n            return gapi.client.classroom.courses.courseWork.studentSubmissions.patch(file)\r\n        })\r\n    )\r\n   .then(e => {\r\n        if(returnAssignment){\r\n            return Promise.all(\r\n                files.map((file, i) => {\r\n                    return gapi.client.classroom.courses.courseWork.studentSubmissions.return({\r\n                        courseId: file.courseId, courseWorkId: file.courseWorkId, id: file.id\r\n                    })\r\n                })\r\n            )\r\n        }else{\r\n            return e;\r\n        }\r\n    })\r\n    .then(classroomThen)\r\n  }\r\n  \r\n  export const markAssignments = (courseId, courseWorkId) => {\r\n    let studentSubmissions = null;\r\n    return gapi.client.classroom.courses.courseWork.studentSubmissions.list({\r\n        courseId, courseWorkId\r\n    }).then(e => {\r\n        let filtered = e.result.studentSubmissions.filter(e => {\r\n            // && e.assignmentSubmission.attachments && e.assignmentSubmission.attachments.length > 0\r\n            return e.state === 'TURNED_IN';\r\n        });\r\n        studentSubmissions = filtered;\r\n        let latest = null;\r\n        return Promise.all(filtered.map(ss => {\r\n            latest = ss.assignmentSubmission.attachments[ss.assignmentSubmission.attachments.length - 1];\r\n            return gapi.client.drive.files.get({\r\n                fileId: latest.driveFile.id,\r\n                fields: 'appProperties, webViewLink'\r\n            })\r\n        }));\r\n    }).then(files => {\r\n        let ssId = null;\r\n        return Promise.all(\r\n            files.map((file, i) => {\r\n                ssId = studentSubmissions[i].id;\r\n                log(`markAssignments patching ss ${ssId} with grade ${file.result.appProperties.gamegrade}`);\r\n                return gapi.client.classroom.courses.courseWork.studentSubmissions.patch({\r\n                    courseId, courseWorkId, id: studentSubmissions[i].id,\r\n                    updateMask:'draftGrade',\r\n                    draftGrade: file.result.appProperties.gamegrade,\r\n                })\r\n            })\r\n        )\r\n    })\r\n   .then(e => {\r\n        return Promise.all(\r\n            studentSubmissions.map((ss, i) => {\r\n                return gapi.client.classroom.courses.courseWork.studentSubmissions.return({\r\n                    courseId, courseWorkId, id: ss.id\r\n                })\r\n            })\r\n        )\r\n    }).then(classroomThen)\r\n  }\r\n  \r\n  export const turnIn = (courseId, courseWorkId, submissionId, title, document, gameGrade) => {\r\n    if(!document) throw new Error(`turnin submission must have a document to submit`);\r\n    //attach material\r\n    let file = {};\r\n    return createReport(title, document, {gameGrade, courseId, courseWorkId, submissionId}).then(e => {\r\n        file.id = e.reportId;\r\n        //error thrown: HTTP400: BAD REQUEST - The request could not be processed by the server due to invalid syntax.\r\n        return gapi.client.classroom.courses.courseWork.studentSubmissions.modifyAttachments(\r\n            {courseId, courseWorkId, id: submissionId,\r\n                addAttachments: [\r\n                    {\r\n                        \"driveFile\": file\r\n                    }\r\n                ]\r\n            }\r\n        )\r\n    })\r\n    .then(e => {\r\n        return gapi.client.classroom.courses.courseWork.studentSubmissions.turnIn(\r\n            {courseId, courseWorkId, id: submissionId}\r\n        )\r\n    })//.then(classroomThen)\r\n  \r\n  }\r\n  export const reclaimSubmission = (courseId, courseWorkId, submissionId, title, document, gameGrade) => {\r\n    if(!document) throw new Error(`recalaim submission must have a document to submit`);\r\n    return gapi.client.classroom.courses.courseWork.studentSubmissions.reclaim(\r\n        {courseId, courseWorkId, id: submissionId}\r\n    ).then(e => {\r\n        return turnIn(courseId, courseWorkId, submissionId, title, document, gameGrade);\r\n    })\r\n  }\r\n  \r\n  export const createCoursework = (coursework) => {\r\n    return gapi.client.classroom.courses.courseWork.create({\r\n        ...coursework\r\n    }).then(classroomThen);\r\n  }\r\n  export const modifyAssignees = (courseId, courseWorkId, students) => {\r\n    return gapi.client.classroom.courses.courseWork.modifyAssignees({\r\n        courseId, id: courseWorkId,\r\n        assigneeMode: 'INDIVIDUAL_STUDENTS',\r\n        modifyIndividualStudentsOptions: {\r\n            'addStudentIds': students.map(e => e.id)\r\n        }\r\n    }).then(classroomThen);\r\n  }\r\n  \r\n  export const getCourses = () => {\r\n    return gapi.client.classroom.courses.list()\r\n    .then(classroomThen);\r\n  }\r\n  \r\n  export const getCourseWork = (courseId, pageSize, pageToken) => {\r\n    return gapi.client.classroom.courses.courseWork.list({\r\n        courseId,\r\n        pageSize: pageSize || 10,\r\n        pageToken\r\n    }).then(classroomThen);\r\n  }\r\n  export const getSubmissionsforCourseWork = (courseId, courseWorkId) => {\r\n    return gapi.client.classroom.courses.courseWork.studentSubmissions\r\n    .list({courseId, courseWorkId}).then(classroomThen);\r\n  }\r\n  export const getAllMyCourseWorkForCourse = (courseId) => {\r\n    return gapi.client.classroom.courses.courseWork.studentSubmissions\r\n    .list({courseId, courseWorkId: '-'}).then(classroomThen);\r\n  }\r\n  export const listStudents = (courseId) => {\r\n    return gapi.client.classroom.courses.students.list({courseId})\r\n    .then(classroomThen)\r\n  }","import React, { useState, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {getSubmissionsforCourseWork} from 'apis/firebase/gapiFunctions';\r\nimport SubscriptionHoC from 'views/hoc/Subscribable';\r\nimport Text from 'views/Text/Text/v1/Text';\r\nimport Button from 'views/Button/v1/Button.js';\r\nimport Loading from 'views/Loading/v1/Loading';\r\nimport {cloudCatch} from 'apis/firebase/cloudFunctions';\r\nimport {log} from 'utilities/Measure';\r\nimport {AnimatePresence, motion} from 'framer-motion'; \r\nimport {ANIM_LAYOUT_OVERLAP} from 'game/tree/Animations.js';\r\n\r\nconst SelectSubmission = (props) => {\r\n    const [studentSubmissions, setStudentSubmissions] = useState(null);\r\n    useEffect(()=>{\r\n        handleSelectSubmission()\r\n    }, [])\r\n    const handleSelectSubmission = async (uid) => {\r\n        props.doSubscribe('selectSubmissionGetSubmissionsForCoursework', \r\n        ()=>{return getSubmissionsforCourseWork(props.courseId, props.courseWorkId)},\r\n        result => {\r\n            if(result.studentSubmissions && result.studentSubmissions.length > 0){\r\n                setStudentSubmissions(result.studentSubmissions.filter(f => f.associatedWithDeveloper));\r\n            }else{\r\n                throw new Error(`no coursework found for course ${props.courseId}`);\r\n            }\r\n        },\r\n        cloudCatch,\r\n        props.onError);\r\n    }\r\n    const handleSelect = (i) => {\r\n       // let i = parseInt(ev.target.name);\r\n        let item = studentSubmissions[i];\r\n        props.onSelect(props.id, {submissionId: item.id, link: item.alternateLink});\r\n    }\r\n    const handleReclaim = (i) => {\r\n        //let i = parseInt(ev.target.name);\r\n        let item = studentSubmissions[i];\r\n        props.onSelect(props.id, {submissionId: item.id, link: item.alternateLink, reclaim: true});\r\n    }\r\n \r\n    const getSubmissionView = (course, i) => {\r\n        if(course.state === 'CREATED' || course.state === 'NEW'){\r\n            return <React.Fragment>\r\n                <Text className=\"block text-center\">You can turn in this games performance report to complete this assignment.</Text>\r\n                <div>\r\n                <Button id={i} onInput={handleSelect} compact>Turn in</Button>\r\n                </div>\r\n            </React.Fragment>\r\n        }else if(course.state === 'RECLAIMED_BY_STUDENT'){\r\n            return <React.Fragment>\r\n                <Text className=\"block text-center\">You have reclaimed this assignment, \r\n                you can turn in this games performance report to complete this assignment</Text>\r\n                <div>\r\n                    <Button id={i} onInput={handleSelect} compact>Turn in</Button>\r\n                </div>\r\n            </React.Fragment>\r\n        }else if(course.state === 'TURNED_IN'){\r\n            return <React.Fragment>\r\n            <Text className=\"block text-center\">You have turned in this assignment, \r\n            you can reclaim and turn in this games performance report in it's place</Text>\r\n            <div>\r\n            <Button id={i} onInput={handleReclaim} compact>Reclaim and turn in</Button>\r\n            </div>\r\n        </React.Fragment>\r\n        }else if(course.state === 'RETURNED'){\r\n            return <React.Fragment>\r\n                <Text className=\"block text-center\">Your teacher has returned this assignment to you, \r\n                    you can turn in this games performance report in it's place</Text>\r\n                    <div>\r\n                <Button id={i} onInput={handleSelect} compact>Turn in</Button>\r\n                </div>\r\n            </React.Fragment>\r\n        }\r\n    }\r\n    return <AnimatePresence>\r\n        {studentSubmissions && <motion.div key=\"submissions\" {...ANIM_LAYOUT_OVERLAP}>\r\n            {studentSubmissions.map((course, i) => {\r\n                return <div key={course.id} className=\"text-center\">\r\n                    {/* <Text text={[\r\n                        {href: course.alternateLink, text: 'Assignment: ', leave: true},\r\n                        {text: `${course.state}`}\r\n                    ]} />\r\n                    {(course.state === 'CREATED' || course.state === 'RECLAIMED_BY_STUDENT' || course.state === 'NEW') \r\n                        && <Button id={i} onInput={handleSelect}>Turn in</Button>}\r\n                    {course.state === 'TURNED_IN' && \r\n                        <Button id={i} onInput={handleReclaim}>reclaim and overwrite</Button>}\r\n                    {course.state === 'RETURNED' && \r\n                        <Button id={i} onInput={handleSelect}>resubmit</Button>} */}\r\n                    {getSubmissionView(course, i)}\r\n                </div>\r\n            })}\r\n        </motion.div>}\r\n        {!studentSubmissions && <motion.div key=\"loading\" {...ANIM_LAYOUT_OVERLAP}>\r\n            <Loading delay={0} text=\"Retrieving coursework submissions\"/>\r\n            </motion.div>}\r\n    </AnimatePresence>\r\n}\r\n\r\nSelectSubmission.propTypes = {\r\n    id: PropTypes.string,\r\n    course: PropTypes.string,\r\n    onSelect: PropTypes.func\r\n}\r\n\r\nexport default SubscriptionHoC(SelectSubmission);","import React, {useState, useEffect} from 'react';\r\nimport {withTheme} from 'styled-components';\r\nimport Button from 'views/Button/v1/Button';\r\nimport Text from 'views/Text/Text/v1/Text';\r\nimport SelectCourse from 'apis/classroom/getters/SelectCourse/index';\r\nimport SelectCourseWork from 'apis/classroom/getters/SelectCourseWork/index';\r\nimport SelectSubmission from 'apis/classroom/getters/SelectSubmission/index';\r\nimport {setGrade, turnIn, reclaimSubmission} from 'apis/firebase/gapiFunctions';\r\nimport {studentPermissions} from 'apis/config';\r\nimport SubscriptionHoC from 'views/hoc/Subscribable';\r\nimport {buildDocument} from 'game/report/utilities';\r\nimport { globalHistory } from \"@reach/router\"\r\nimport {cloudCatch} from 'apis/firebase/cloudFunctions';\r\nimport {roundTo} from 'utilities/Format';\r\nimport {log} from 'utilities/Measure';\r\nimport {AnimatePresence, motion} from 'framer-motion'; \r\nimport {ANIM_LAYOUT_OVERLAP} from 'game/tree/Animations.js';\r\nimport Loading from 'views/Loading/v1/Loading';\r\n//will need grade to assign\r\nconst ST_DEFAULT = 'def', ST_COURSE = 'course', ST_COURSE_WORK = 'coursework', ST_PROCESSING ='processing', \r\nST_SUBMISSIONS='submissions', ST_SUCCESS = 'success', ST_ERR = 'err';\r\nconst SubmitCourseWork = (props) => {\r\n    const [error, setError] = useState(null);\r\n    const [fsm, setFsm] = useState(ST_COURSE);\r\n    const [courseId, setCourseId] = useState(null);\r\n    const [courseWorkId, setCourseWorkId] = useState(null);\r\n    const [submission, setSubmission] = useState(null);\r\n\r\n \r\n    const changeState = (key, payload) => {\r\n        if(fsm === ST_DEFAULT){ //a call from sign in\r\n            setFsm(ST_COURSE);\r\n        }else if(fsm === ST_COURSE){\r\n            setCourseId(payload.courseId);\r\n            setFsm(ST_COURSE_WORK);\r\n        }else if(fsm === ST_COURSE_WORK){\r\n            setCourseWorkId(payload.courseWorkId);\r\n            setFsm(ST_SUBMISSIONS);\r\n        }else if(fsm === ST_SUBMISSIONS){\r\n            setSubmission(payload);\r\n            setFsm(ST_PROCESSING);\r\n            submitAssignment(courseId, courseWorkId, payload.submissionId, payload.reclaim);\r\n        }else if(fsm === ST_PROCESSING){\r\n\r\n        }\r\n    }\r\n    const submitAssignment = (cId, cwId, sId, reclaim) => {\r\n       let fun = reclaim?reclaimSubmission:turnIn;\r\n       setFsm(ST_PROCESSING);\r\n       let document =  buildDocument(props.game, props.data, props.theme, `${props.meta.title} Report`, \r\n            false, false, globalHistory.location.href);\r\n       props.doSubscribe('submitCourseWorkSubmitAssignment', \r\n       (q) => { return fun(cId, cwId, sId, props.meta.title, document, roundTo(props.data.finalMark*100, 2))},\r\n       e => {\r\n            setFsm(ST_SUCCESS);\r\n        },\r\n        (e) => {\r\n            if(e.status === 400){\r\n                if(reclaim){\r\n                    return `Failed a precondition: You might be trying to reclaim a submission that is either not turned in, or has been returned.`;\r\n                }else{\r\n                    return `Failed a precondition: You might be trying to turn in an assignment that has already been turned in.`;\r\n                }\r\n                \r\n            }else if( e.error && e.error.message === 'The caller does not have permission'){\r\n                return `Failed a precondition: You are not allowed to edit that item. If you're logged in as a teacher, \r\n                    please use the teacher section on the game menu to edit student reports.`;\r\n            }else{\r\n                let res = cloudCatch(e);\r\n                return res;\r\n            }\r\n        }, setError)\r\n    }\r\n    const renderState = () => {\r\n        \r\n        switch(fsm){\r\n            case ST_SUCCESS: return <div>\r\n                <div><Text color=\"primary\" className=\"block text-center\">success</Text></div>\r\n                <div><Text className=\"block text-center\"><a href={submission.link} target=\"_blank\">link to submission</a></Text></div>\r\n            </div>\r\n            case ST_PROCESSING: return <Loading text=\"Submitting your course work\"/>\r\n            case ST_SUBMISSIONS: return <SelectSubmission key={ST_SUBMISSIONS} id={ST_SUBMISSIONS} courseId={courseId} courseWorkId={courseWorkId} error={error}\r\n                subscribe={props.subscribe} onSelect={changeState} permissions={studentPermissions} onError={setError} />\r\n            case ST_COURSE_WORK: return  <SelectCourseWork \r\n                key={ST_COURSE_WORK} id={ST_COURSE_WORK} courseId={courseId} onSelect={changeState} error={error}\r\n                filterByTitle={props.meta.title} pageSize={100}\r\n                subscribe={props.subscribe}  permissions={studentPermissions} onError={setError} />\r\n            case ST_COURSE:  \r\n            default: return <SelectCourse key={ST_COURSE} id={ST_COURSE} onSelect={changeState} permissions={studentPermissions} \r\n                subscribe={props.subscribe} onError={setError} error={error}/>\r\n        }\r\n    }\r\n    return <AnimatePresence>\r\n        {error && <motion.div key=\"error\" {...ANIM_LAYOUT_OVERLAP}><Text color=\"secondary\">Error: {error}</Text></motion.div>}\r\n        {!error && <motion.div key={fsm} {...ANIM_LAYOUT_OVERLAP}>{renderState()}</motion.div>}\r\n    </AnimatePresence>\r\n}\r\n\r\nexport default withTheme(SubscriptionHoC(SubmitCourseWork));","const COLLECTION_EXAMS_TEST = 'testExams';\r\nconst COLLECTION_EXAMS_LIVE = 'exams';\r\nconst COLLECTION_PLAYERS_TEST = 'testPlayers';\r\nconst COLLECTION_PLAYERS_LIVE = 'players';\r\nconst COLLECTION_PAYMENTS_TEST = 'testPayments2';\r\nconst COLLECTION_PAYMENTS_LIVE = 'payments';\r\n\r\n\r\nconst PAY_EXAM_VALUE = '5.00';\r\nconst PAY_EXAM_VALUE_STRIPE = 500;\r\nconst PAY_EXAM_VALUE_PAYPAL = '5.00';\r\n\r\nconst PAY_REPORT_VALUE_STRIPE = 1000;\r\nconst PAY_REPORT_VALUE = '10.00';\r\nconst PAY_REPORT_VALUE_PAYPAL = '10.00';\r\n\r\nconst PAY_CURRENCY = 'AUD';\r\n\r\nconst PRODUCT_EXAM = 'exam';\r\nconst PRODUCT_REPORT = 'report';\r\n\r\nconst PAYPAL_ID = 'paypalId';\r\nconst STRIPE_ID = 'stripeId';\r\nconst STRIPE_SANDBOX_API_KEY = 'pk_test_TihZRayuBClTOrqPzysoX86p00rITy6lt2';\r\nconst STRIPE_LIVE_API_KEY = 'pk_live_NNcJevNYmVuwnZSVEPjCWdYv00Dri8SnWf';\r\nconst PAYPAL_SANDBOX_API_KEY = 'Aera3gBeOoXF6uFm2HwLeOeV90vnwc1VufL9bj1cTXyq05ArwaLUhPGg9VM8shjnw1w5yo7tQXLBdUMc';\r\nconst PAYPAL_LIVE_API_KEY ='ASk_D1qAbh_gjj7sOvXUUc1XadpS0sgykHgppBCe3mjYxA7PlayZxJhXJ0rjvxBK3k2fi_E1MpLd8Jjj';\r\n\r\nconst PAYPAL_MODE = 'live'; //sandbox live\r\nconst VENDOR_PAYPAL = 'paypal';\r\nconst VENDOR_STRIPE = 'stripe';\r\n\r\nconst FREE_EXAM = 3;\r\nconst FREE_REPORT = 3;\r\nconst REFUND_MAX_REPORT = 5;\r\nconst REFUND_MAX_EXAM = 5;\r\n\r\nconst getUnlockedKey = (type) => `unlocked${type}`;\r\nconst getCounterKey = (type) => `${type}count`;\r\nconst getFreeAmount = (type) => {\r\n    switch(type){\r\n        default: return FREE_REPORT;\r\n    }\r\n};\r\nconst getRefundAmount = (type) => {\r\n    switch(type){\r\n        default: return REFUND_MAX_REPORT;\r\n    }\r\n};\r\nconst getPaymentAmount = (vendor, product) => {\r\n    if(vendor === VENDOR_STRIPE){\r\n        if(product === PRODUCT_EXAM){\r\n            return PAY_EXAM_VALUE_STRIPE;\r\n        }else if(product === PRODUCT_REPORT){\r\n            return PAY_REPORT_VALUE_STRIPE;\r\n        }\r\n    }else if(vendor === VENDOR_PAYPAL){\r\n        if(product === PRODUCT_EXAM){\r\n            return PAY_EXAM_VALUE_PAYPAL;\r\n        }else if(product === PRODUCT_REPORT){\r\n            return PAY_REPORT_VALUE_PAYPAL;\r\n        }\r\n    }\r\n    throw Error(`invalid vendor ${vendor} or product ${product}`)\r\n}\r\nconst validateProduct = (product) => {\r\n    return product === PRODUCT_REPORT || product === PRODUCT_EXAM;\r\n}\r\n\r\nconst INITIAL_PLAYER_STATE = {reportcount: 0, examcount: 0};\r\n    //sandboxclientid\r\n\r\nexports.COLLECTION_PLAYERS = COLLECTION_PLAYERS_LIVE;     \r\nexports.COLLECTION_EXAMS = COLLECTION_EXAMS_LIVE;     \r\nexports.COLLECTION_PAYMENTS = COLLECTION_PAYMENTS_LIVE;     \r\nexports.PAY_EXAM_VALUE =  PAY_EXAM_VALUE;     \r\nexports.PAY_EXAM_VALUE_STRIPE =  PAY_EXAM_VALUE_STRIPE;     \r\nexports.PAY_REPORT_VALUE = PAY_REPORT_VALUE;     \r\nexports.PAY_REPORT_VALUE_STRIPE = PAY_REPORT_VALUE_STRIPE;     \r\nexports.PAY_CURRENCY = PAY_CURRENCY;     \r\nexports.PRODUCT_EXAM = PRODUCT_EXAM;     \r\nexports.PRODUCT_REPORT = PRODUCT_REPORT;     \r\nexports.PAYPAL_ID = PAYPAL_ID;     \r\nexports.STRIPE_ID = STRIPE_ID;     \r\nexports.FREE_EXAM = FREE_EXAM;     \r\nexports.FREE_REPORT = FREE_REPORT;     \r\nexports.INITIAL_PLAYER_STATE = INITIAL_PLAYER_STATE;     \r\nexports.getUnlockedKey = getUnlockedKey;     \r\nexports.getCounterKey = getCounterKey;     \r\nexports.getFreeAmount = getFreeAmount;\r\nexports.getRefundAmount = getRefundAmount;\r\nexports.getPaymentAmount = getPaymentAmount;\r\nexports.validateProduct = validateProduct;\r\n// exports.STRIPE_SANDBOX_API_KEY = STRIPE_SANDBOX_API_KEY;\r\n// exports.STRIPE_LIVE_API_KEY = STRIPE_LIVE_API_KEY;\r\nexports.STRIPE_API_KEY = STRIPE_LIVE_API_KEY;\r\nexports.PAYPAL_LIVE_API_KEY = PAYPAL_LIVE_API_KEY;\r\nexports.PAYPAL_SANDBOX_API_KEY = PAYPAL_SANDBOX_API_KEY;\r\nexports.PAYPAL_MODE = PAYPAL_MODE;\r\nexports.PAY_REPORT_VALUE_PAYPAL = PAY_REPORT_VALUE_PAYPAL;\r\nexports.PAY_EXAM_VALUE_PAYPAL = PAY_EXAM_VALUE_PAYPAL;\r\nexports.VENDOR_PAYPAL = VENDOR_PAYPAL;\r\nexports.VENDOR_STRIPE = VENDOR_STRIPE;","const defaultKeys = {\r\n    DELETED: 'DELETED',\r\n    aMath: 'math', aErr: 'error', \r\n    acMath: 'math', acGameMCQ:'gamemcq', acFeature:'feature', acGame:'game', acSim:'sim', acModal:'modal', acMenu: 'menu', acDia: 'dialogue',\r\n    acSimCom:'gamecomplete',  acSimFinalScore: 'finalScore',\r\n    acLoc: 'location', aclocData: 'data', aclocStory: 'story', \r\n    actModBuild:'modelBuild', actModAccept: 'modelAccept', actModFinal: 'modelFinal',\r\n    actPredBuild:'predBuild', actPredAccept: 'predAccept', actPredFinal: 'predFinal',\r\n   \r\n    aclocChar: 'character', acAct: 'act', acChoice: 'choice',\r\n    c: 'c', act: 'act', lab: 'lab', ev: 'ev',\r\n    aMathTool: 'mathtool', aMove: 'move', mMeas: 'measure',\r\n    prim: 'primary', secon: 'secondary',\r\n    cdSound: 'dimension1', cdDiff: 'dimension2', cdDiffSes: 'dimension3',\r\n    setDiff:'difficulty', setSound:'sound', setAni: 'animation', setExam:'exam',\r\n    setFont:'fontsize',\r\n    scoreRange: 0.5,\r\n    dp: 2,\r\n    modelValue: 'modelValue',\r\n    userValue: 'userValue'\r\n    // createModel: (id, name, modelScore, valueScore, valueSim, valueUser, description) => \r\n    //     {return {id, name, modelScore, valueScore, valueSim, valueUser, description}},\r\n    \r\n}\r\n\r\n//a-keys are used in Analytic events;\r\n//ac = Analytic Category\r\n\r\nmodule.exports = defaultKeys;\r\n","const firebase = require(\"firebase\");\r\n// Required for side-effects\r\nrequire(\"firebase/functions\");\r\nimport {log, sendError} from 'utilities/Measure';\r\n\r\n\r\nexport const getPermission = (permissions, onPermitted) => {\r\n    let user = firebase.auth().currentUser;\r\n    let provider = getProvider(firebase.auth().currentUser, permissions);\r\n    return {\r\n        //promise: ()=>{return firebase.auth().signInWithPopup(provider)},\r\n        promise: ()=>{return firebase.auth().signInWithRedirect(provider)},\r\n        then:function(result) {\r\n            if(window && window.gapi){\r\n                gapi.client.setToken({access_token: result.credential.accessToken});\r\n                onPermitted();\r\n            }\r\n          },\r\n        cat:function(error) {\r\n           if(error.message){\r\n            return error.message;\r\n           }\r\n           return error;\r\n        } \r\n    }\r\n}\r\n\r\n\r\nconst getGoogleProvider = (permissions) => {\r\n    let google =  new firebase.auth.GoogleAuthProvider();\r\n        if(permissions){\r\n            permissions.map(e => {\r\n                google.addScope(e);\r\n            })\r\n        }\r\n        return google;\r\n}\r\nconst getProvider = (user, permissions) => {\r\n    let providerId = user?user.providerData[0].providerId:null;\r\n    if(permissions){\r\n        return getGoogleProvider(permissions);\r\n    }else{\r\n        switch(providerId){\r\n            case 'google.com': return getGoogleProvider(permissions);\r\n            case 'twitter.com': return new firebase.auth.TwitterAuthProvider();\r\n            case 'facebook.com': return new firebase.auth.FacebookAuthProvider();\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport const cloudThen = (callback) => (e) => {\r\n    if(e.data && !e.data.hasOwnProperty('fail')){\r\n        callback(e.data);\r\n    }else if(e.data.hasOwnProperty('fail')){\r\n        if(typeof e.data.fail === 'string'){\r\n            throw new Error(e.data.fail);\r\n        }else{\r\n            throw new Error('cloud function failed');\r\n        }\r\n        \r\n    }else{\r\n        throw new Error('No such record found');\r\n    }\r\n}\r\nexport const cloudThenInline = (e) => {\r\n    if(e.data && !e.data.hasOwnProperty('fail')){\r\n        return e.data;\r\n    }else if(e.data.hasOwnProperty('fail')){\r\n        if(typeof e.data.fail === 'string'){\r\n            throw new Error(e.data.fail);\r\n        }else{\r\n            throw new Error('cloud function failed');\r\n        }\r\n        \r\n    }else{\r\n        throw new Error('No such record found');\r\n    }\r\n}\r\nexport const cloudCatch = (e) => {\r\n    if(e.result && e.result.error){\r\n        sendError(`cloudCatch ${e.result.error.message}`, false);\r\n        return e.result.error.message;\r\n    }else if(e.error){\r\n        sendError(`cloudCatch ${e.error}`, false);\r\n        return e.error;\r\n    }else if(e.message){\r\n        sendError(`cloudCatch ${e.message}`, false);\r\n        return  e.message;\r\n    }else if(typeof e === 'string'){\r\n        sendError(`cloudCatch ${e}`, false);\r\n        //may be an error string passed from thrown then error\r\n        return e;\r\n    }else{\r\n        sendError(`cloudCatch Incorrectly formatted cloudCatch error`, false);\r\n        //throw new Error('Incorrectly formatted cloudCatch error', e);\r\n        return 'Incorrectly formatted cloudCatch error';\r\n    }\r\n}\r\n\r\n\r\n//** EXAM */\r\n\r\nexport const loadExam = (examId) => {\r\n    return firebase.functions().httpsCallable('loadExam')({examId}).then(cloudThenInline);\r\n}\r\nexport const startExam = (game) => {\r\n    return firebase.functions().httpsCallable('startExam')({game}).then(cloudThenInline);\r\n}\r\nexport const createExam = (game, settings) => {\r\n    return firebase.functions().httpsCallable('createExam')({game, settings}).then(cloudThenInline);\r\n}\r\nexport const deletePlayer = (uid) => {\r\n    return firebase.functions().httpsCallable('deletePlayer')({uid});\r\n}\r\nexport const updateExam = (examId, game, node, local) => {\r\n    return firebase.functions().httpsCallable('updateExam')({examId, game, node, local}).then(cloudThenInline);\r\n}\r\n\r\n\r\nexport const endGame = (examId, game, local) => {\r\n    return firebase.functions().httpsCallable('endGame')({examId, game, local}).then(cloudThenInline);\r\n}\r\n\r\nexport const initExam = (examId, game, settings) => {\r\n    return firebase.functions().httpsCallable('initalizeExam')({examId, game, settings}).then(cloudThenInline);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n/** STRIPE */\r\nexport const createPaymentIntent = (eventId, paymentType) => {\r\n    return firebase.functions().httpsCallable('createPaymentIntent')({eventId, paymentType})\r\n    .then(cloudThenInline);\r\n}\r\n\r\n\r\nexport const checkCustomerStatus = (eventId, paymentType) => {\r\n    return firebase.functions().httpsCallable('checkCustomerStatus')({eventId, paymentType})\r\n    .then(cloudThenInline);\r\n}\r\n\r\nexport const cancelPaymentIntent = (paymentIntentId) => {\r\n    return firebase.functions().httpsCallable('cancelPaymentIntent')({paymentIntentId})\r\n    .then(cloudThenInline);\r\n}\r\n\r\nexport const refundPayment = (paymentType) => {\r\n    return firebase.functions().httpsCallable('refundPayment')({paymentType})\r\n    .then(cloudThenInline);\r\n}\r\n\r\nexport const validateCaptcha = (token, v2) => {\r\n    return firebase.functions().httpsCallable('validateCaptcha')({token, v2})\r\n    .then(cloudThenInline);\r\n}\r\n\r\n//capturePaypalPayment\r\nexport const capturePaypalPayment = (orderID, authorizationID) => {\r\n    return firebase.functions().httpsCallable('capturePaypalPayment')({orderID, authorizationID})\r\n    .then(cloudThenInline);\r\n}\r\n","import React, {useState, useEffect} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport styled from 'styled-components';\r\nimport { graphql, Link } from 'gatsby';\r\n\r\nimport NoScript from 'views/Website/NoScript/NoScript.js';\r\nimport Loading from 'views/Loading/v1/Loading.js'\r\nimport Loadable from 'react-loadable';\r\nimport {sendError} from 'utilities/Measure.js';\r\nimport {Helmet} from 'react-helmet';\r\nimport Text from 'views/Text/Text/v1/Text';\r\nimport ErrorBoundary from 'views/Boundary/Boundary.js';\r\nimport SiteContainer from 'views/Container/Container.js';\r\nimport {motion} from 'framer-motion';\r\nimport {log} from 'utilities/Measure.js';\r\nimport Meta from 'views/SEO/Meta/Meta';\r\nimport {getUrl, getHost} from 'utilities/Format.js';\r\nimport {ANIM_LAYOUT_OVERLAP, ANIM_LAYOUT_OVERLAP_EBE, keys as animKeys, animations} from 'animations';\r\nimport {getCharacterSrc} from 'game/Views/Image/poses';\r\nimport Main from 'game/Main.js';\r\nimport AbsoluteBox from 'views/Box/AbsoluteCentered/index';\r\n\r\nconst GamePost = (props) => {\r\n    const [Loader, setLoad] = useState(null);\r\n    const [images, setImages] = useState(null);\r\n    console.log(`GamePost props`, props);\r\n    useEffect(()=>{\r\n        setLoad({loadable: Load(Main, props.data.game, props.addMenuItem, props.data.logo, props.data.game.images)});\r\n        let meta = props.data.game;\r\n        getCharacterSrc(meta.images).then(e=> {\r\n          if(meta.gameImages){\r\n              meta.gameImages.map(img => {\r\n                      e[img.id] =img.src.childImageSharp.fluid.src;\r\n              })\r\n          }\r\n          setImages(e);\r\n      }).catch(e => {\r\n              log(`game-post catch`, e);\r\n      })\r\n    }, [])\r\n\r\n    const getImg = () => {\r\n      if(props.data.game.twitterCard) return getHost() + props.data.game.twitterCard.childImageSharp.fixed.src;\r\n      return null;\r\n    }\r\n    return (\r\n      \r\n        <SiteContainer style={styles} key=\"game-post\" id=\"game-post\" className=\"site-container-no-scroll\" \r\n\r\n          >\r\n          <Helmet title={`${props.data.game.title} | ${props.data.site.siteMetadata.title} Math Game`} >\r\n   \r\n          </Helmet>\r\n          <Meta {...props.data.game} \r\n            host={getHost()} //url={getUrl()} \r\n            tags={props.data.topics} \r\n            description={props.data.game.snippet}\r\n            img={getImg()} \r\n            iconAlt={'Stimsims game icon'}\r\n          >\r\n            {props.data.game.descriptions && props.data.game.descriptions.map(d => {\r\n              if(d.text){\r\n                return <p>{d.text}</p>\r\n              }\r\n              return null;\r\n            })}\r\n          </Meta>\r\n          <ErrorBoundary id=\"GameBoundary\" errorView={[\r\n            <Text key={'e0'} tag=\"p\" color=\"orange\" fontSize=\"remM\" >There was a problem running the game.</Text>,\r\n            <Text key={'e1'} tag=\"p\" color=\"orange\" fontSize=\"remM\" >It has been noted and logged.</Text>,\r\n            <Text key={'e2'} tag=\"p\" color=\"orange\" fontSize=\"remM\" >Please try again later.</Text>,\r\n          ]}>\r\n            {Loader && images &&  <Loader.loadable \r\n              logo={props.data.site.siteMetadata.siteUrl + props.data.logo.childImageSharp.fixed.src}\r\n              images={images}\r\n              BUILD_GAME={props.BUILD_GAME}\r\n              />}\r\n            {!Loader && props.addMenuItem && <Loading addMenuItem={props.addMenuItem} />}\r\n          </ErrorBoundary>\r\n\r\n        </SiteContainer>\r\n        \r\n    )\r\n}\r\n\r\nconst styles = {height:'100%', position: 'relative'};\r\nconst motionStyles = {position: 'absolute', width: '100%', top: '50%', transform: 'translateY(-50%)'}\r\nGamePost.propTypes = {\r\n    data: PropTypes.shape({\r\n      game: PropTypes.shape({\r\n          import: PropTypes.string,\r\n          title: PropTypes.string,\r\n      }),\r\n      site: PropTypes.object,\r\n      logo: PropTypes.object,\r\n  }),\r\n}\r\nexport default GamePost;\r\n\r\nconst Load = (Main, game, addMenuItem, logo, images) => {\r\n  return Loadable.Map({\r\n    timeout: 10000,\r\n    delay: 0,\r\n    loader: {\r\n      game: ()=>{return getGame(game.import)},\r\n     // GameTool: () => import('game/Main.js'),\r\n    },\r\n    loading: (props)=>{\r\n      if (props.error) {\r\n        sendError(`failed to load game main page: ${props.error.message} stack ${props.error.stack}`, true, 1);\r\n        return <motion.div key=\"game-post-error\"  style={motionStyles} \r\n        // {...animations[animKeys.ANIM_LAYOUT_OVERLAP_EBE]}\r\n        {...ANIM_LAYOUT_OVERLAP}\r\n        >\r\n          <AbsoluteBox>\r\n          <Text  key={'game-post-loading-text'} id={'game-post-loading-text'} tag=\"p\" className=\"text-center\">\r\n           Error loading game. Some browsers do not have the features this game requires. \r\n          Please use an up to date browser for best performance.\r\n          </Text>\r\n        <div className=\"text-center\"><a href=\"/mathgames/\">return to games page</a></div>\r\n          </AbsoluteBox>\r\n        </motion.div>;\r\n      } else {\r\n        return <motion.div key=\"game-post-loading\" id={'game-post-loading'}  style={motionStyles} \r\n        // {...animations[animKeys.ANIM_LAYOUT_OVERLAP_EBE]}\r\n        {...ANIM_LAYOUT_OVERLAP}\r\n        >\r\n         <AbsoluteBox>\r\n         <Loading key={'game-post-loading-view'} id={'game-post-loading-view'} name=\"game-post\" length=\"50px\" />\r\n         </AbsoluteBox>\r\n          </motion.div>;\r\n        //return <p>Hi</p>\r\n      }\r\n      \r\n    },\r\n    render(loaded, props) {\r\n      // let GameTool = loaded.GameTool.default;\r\n        // return <GameTool \r\n        //   {...props}  \r\n        //   game={loaded.game.default} \r\n        //   meta={game} \r\n        //   addMenuItem={addMenuItem} \r\n        //   audio={game.audio} \r\n        // />;\r\n        return <Main \r\n            {...props}  \r\n            game={loaded.game.default} \r\n            meta={game} \r\n            addMenuItem={addMenuItem} \r\n            audio={game.audio} \r\n            BUILD_GAME={props.BUILD_GAME}\r\n        />\r\n      //return <p style={{color: 'cyan'}}>Game Post</p>\r\n    }\r\n  });\r\n}\r\n\r\nconst getGame = (game) => {\r\n  switch(game){\r\n    case 'pythagoras':return import('games/Pythagoras/index.js');\r\n    case 'lovecraft-loop':return import('games/LovecraftLoop/index.js');\r\n    case 'testtool':return import('games/TestTool/index.js');\r\n    case 'fairy-toxic-waste-removal-fraction-addition':return import('games/CleanWork/index.js');\r\n    case 'fairy-toxic-waste-removal-fraction-addition-excerpt':return import('games/FractionsExperiment/index.js');\r\n    default:\r\n      throw new SyntaxError('No game found');\r\n  }\r\n}\r\n\r\n\r\n\r\n\r\n\r\nexport const pageQuery = graphql`\r\n  query GamePostByID($import: String!) {\r\n    site {\r\n      siteMetadata {\r\n        ...siteDataFragment\r\n      }\r\n    },\r\n    logo: file(relativePath: { regex: \"/favicon/\" }) {\r\n      childImageSharp{\r\n        fixed(width: 512, height: 512) {\r\n            ...GatsbyImageSharpFixed\r\n        }\r\n      }\r\n    },\r\n    game: gamesMetaJson(import: { eq: $import }) {\r\n      id\r\n      path\r\n      date\r\n      import\r\n      complete\r\n      hasDifficultySetting\r\n      title\r\n      topics\r\n      snippet\r\n      feedback\r\n      credits{\r\n          heading\r\n          items {\r\n            text\r\n            href\r\n          }\r\n      }\r\n      measurments \r\n      descriptions {\r\n        id\r\n        text\r\n        img {\r\n          childImageSharp {\r\n            fixed(width: 500) {\r\n              ...GatsbyImageSharpFixed\r\n            }\r\n          }\r\n        }\r\n      }\r\n      tweet\r\n      type\r\n      analytics\r\n      reports\r\n      form {\r\n        type\r\n        text\r\n        options\r\n        id\r\n        value\r\n      }\r\n      sounds\r\n      document{\r\n        id\r\n        text\r\n        tag\r\n        heading\r\n        subheading\r\n      }\r\n      audio\r\n      images\r\n      gameSettings{\r\n        visible\r\n        key\r\n        values\r\n      }\r\n      gameImages{\r\n        id\r\n        src {\r\n          childImageSharp {\r\n            fluid(maxWidth: 800) {\r\n              ...GatsbyImageSharpFluid\r\n            }\r\n          }\r\n        }\r\n      }\r\n      intro{\r\n        img{\r\n          key\r\n          pose\r\n        }\r\n        text{\r\n          text\r\n          toLatex\r\n          color\r\n        }\r\n      }\r\n      twitterCard{\r\n        childImageSharp {\r\n          ...socialCardFragment\r\n        }\r\n      }\r\n    }\r\n  }\r\n`\r\n\r\n","import React, { useState, useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {getCourses} from 'apis/firebase/gapiFunctions';\r\nimport Select from 'views/Select/v2/Select';\r\nimport Loading from 'views/Loading/v1/Loading';\r\nimport SubscriptionHoC from 'views/hoc/Subscribable';\r\nimport {cloudCatch} from 'apis/firebase/cloudFunctions';\r\nimport {log} from 'utilities/Measure.js';\r\nimport {AnimatePresence, motion} from 'framer-motion'; \r\nimport {ANIM_LAYOUT_OVERLAP} from 'game/tree/Animations.js';\r\n\r\nconst SelectCourseWork = (props) => {\r\n    const [courses, setCourses] = useState(null);\r\n\r\n   useEffect(()=>{\r\n    createCourseWork();\r\n   }, [])\r\n    const createCourseWork = async () => {\r\n            props.doSubscribe('selectCourseWork', getCourses, (e) => {\r\n                if(e.courses && e.courses.map){\r\n                    let options = e.courses.map(course => {\r\n                        return {label: course.name, value: course.id}\r\n                    })\r\n                    setCourses(options);\r\n                }else{\r\n                    props.onError('No courses found for user');\r\n                }\r\n            }, cloudCatch, props.onError)\r\n    }\r\n    const handleSelect = (id, val) => {\r\n        props.onSelect(props.id, {courseId: val});\r\n    }\r\n    return <AnimatePresence>\r\n        {courses && <motion.div key=\"selectCourse\" {...ANIM_LAYOUT_OVERLAP}>\r\n                <Select id=\"selectCourse\" options={courses} className=\"block\" \r\n                placeholder=\"Select a Course\" onInput={handleSelect} />\r\n            </motion.div>}\r\n        {!courses && <motion.div key=\"loading\" {...ANIM_LAYOUT_OVERLAP}>\r\n                <Loading delay={0} text=\"Retrieving Courses\"/>\r\n            </motion.div>}\r\n    </AnimatePresence>\r\n}\r\n\r\nSelectCourseWork.propTypes = {\r\n    id: PropTypes.string,\r\n    onSelect: PropTypes.func\r\n}\r\n\r\n\r\nexport default SubscriptionHoC(SelectCourseWork)\r\n","import React, {useEffect, useState} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {log} from 'utilities/Measure.js';\r\n\r\nconst LoadScript = (props) => {\r\n    useEffect(()=>{\r\n        loadScript()\r\n    }, []);\r\n    const loadScript = () => {\r\n\r\n      var script = document.createElement('script');\r\n      script.type = 'text/javascript';\r\n      script.src = props.script;\r\n      \r\n      // Once the Google API Client is loaded, you can run your code\r\n      script.onload = (e) => {\r\n       // Initialize the Google API Client with the config object\r\n          if(props.onLoad){\r\n                props.onLoad(e);\r\n          }\r\n  \r\n      }\r\n      // Add to the document\r\n      document.body.appendChild(script);\r\n\r\n    }\r\n    return null;\r\n}\r\n\r\nLoadScript.propTypes = {\r\n    onLoad: PropTypes.func,\r\n    script: PropTypes.string\r\n}\r\n\r\nexport default LoadScript;\r\n"],"sourceRoot":""}