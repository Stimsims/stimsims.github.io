{"version":3,"sources":["webpack:///./src/apis/firebase/firestoreFunctions.js","webpack:///./src/apis/SignIn/GetGapi.js","webpack:///./src/apis/SignIn/SignIn.js","webpack:///./src/apis/config.js","webpack:///./src/pages/account.js","webpack:///./functions/dbConfig.js","webpack:///./src/apis/firebase/cloudFunctions.js","webpack:///./src/apis/LoadScript.js"],"names":["firebase","require","dbConfig","firestoreThen","callback","e","log","exists","r","data","success","error","Error","message","firestoreThenInline","firestoreCatch","getPlayer","uid","firestore","collection","COLLECTION_PLAYERS","doc","get","then","saveExam","examId","save","COLLECTION_EXAMS","update","deleteExam","delete","FieldValue","config","clientId","scope","discoveryDocs","Subscribable","props","LoadScript","apiKey","script","onLoad","gapi","load","doSubscribe","client","init","onApiInit","sendError","signInOptions","provider","auth","TwitterAuthProvider","PROVIDER_ID","FacebookAuthProvider","uiConfig","signInFlow","callbacks","SignOutWrapper","SignInHoC","View","redirectUrl","needsGoogle","useState","setError","isGapiReady","setIsGapiReady","user","setUser","uiInstance","setUiInstance","onAuthStateChanged","getUser","useEffect","deleteUi","getUi","isSigningIn","window","firebaseui","showSignInUi","apps","length","initializeApp","globalHistory","location","hostname","setFirebaseToWindow","ref","onSignOut","signOut","navigate","getUrl","permissions","attempts","console","ui","setPersistence","Auth","Persistence","NONE","resetUi","signInSuccessUrl","signInSuccessWithAuthResult","postSignIn","startUi","fui","AuthUI","getInstance","getUiId","reset","newfui","google","GoogleAuthProvider","scopes","customParameters","getGoogleProvider","start","authResult","credential","setToken","access_token","accessToken","getUrlHash","isSignedIn","u","email","displayName","photoURL","phoneNumber","createTime","metadata","creationTime","lastTime","lastSignInTime","providerData","reduce","agg","el","i","providerId","SignInWrapper","Helmet","type","rel","href","GetGapi","StateBackground","signingIn","StateView","className","IconButton","icon","onInput","color","bgColor","Text","key","id","fontSize","trget","doSignOut","deleteUser","currentUser","doSignIn","styled","div","theme","zUi","zTop","authDomain","databaseURL","projectId","storageBucket","studentPermissions","drivePermissions","teacherCreatePermissions","teacherMarkPermissions","AccountPage","title","site","siteMetadata","center","minHeight","section","text","mediaL","pageQuery","exports","COLLECTION_PAYMENTS","PAY_EXAM_VALUE","PAY_EXAM_VALUE_STRIPE","PAY_REPORT_VALUE","PAY_REPORT_VALUE_STRIPE","PAY_CURRENCY","PRODUCT_EXAM","PRODUCT_REPORT","PAYPAL_ID","STRIPE_ID","FREE_EXAM","FREE_REPORT","INITIAL_PLAYER_STATE","reportcount","examcount","getUnlockedKey","getCounterKey","getFreeAmount","getRefundAmount","getPaymentAmount","vendor","product","validateProduct","STRIPE_API_KEY","PAYPAL_LIVE_API_KEY","PAYPAL_SANDBOX_API_KEY","PAYPAL_MODE","PAY_REPORT_VALUE_PAYPAL","PAY_EXAM_VALUE_PAYPAL","VENDOR_PAYPAL","VENDOR_STRIPE","cloudThen","hasOwnProperty","fail","cloudThenInline","cloudCatch","result","loadExam","functions","httpsCallable","createExam","game","settings","deletePlayer","updateExam","node","local","endGame","createPaymentIntent","eventId","paymentType","checkCustomerStatus","refundPayment","validateCaptcha","token","v2","capturePaypalPayment","orderID","authorizationID","loadScript","document","createElement","src","onload","body","appendChild","propTypes","PropTypes","func","string"],"mappings":"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","file":"component---src-pages-account-js-e4655c4617a06ff62969.js","sourcesContent":["const firebase = require(\"firebase\");\r\n// Required for side-effects\r\nrequire(\"firebase/functions\");\r\nimport {log, sendError} from 'utilities/Measure.js';\r\n\r\n//const COLLECTION_PLAYERS = 'players', COLLECTION_EXAMS = 'exams';\r\nconst dbConfig = require('./../../../functions/dbConfig.js');\r\n\r\nexport const firestoreThen = (callback) => (e) => {\r\n    //delete returns nothing\r\n    log(`firestore inline then e`, e);\r\n    if(!e){\r\n        callback(null);\r\n    }else if(e.exists){\r\n        let r = e.data();\r\n        callback(r);\r\n    }else if(e.data && e.data.success){\r\n        callback(e.data.success);\r\n    }else if(e.error){\r\n        throw new Error(e.error.message);\r\n    }else{\r\n        throw new Error('No such record found');\r\n    }\r\n}\r\nexport const firestoreThenInline =  (e) => {\r\n    //e = {error: {message: 'test error'}};\r\n    //delete returns nothing\r\n    log(`firestore inline catch e`, e);\r\n    if(e.exists){\r\n        let r = e.data();\r\n        return r;\r\n    }else if(e.data && e.data.success){\r\n        return e.data.success;\r\n    }else if(e.error){\r\n        throw new Error(e.error.message);\r\n    }else{\r\n        throw new Error('No such record found');\r\n    }\r\n}\r\n\r\nexport const firestoreCatch = (e) => {\r\n   // log(`firestore catch e`, e);\r\n    if(typeof e === 'string'){\r\n      //  sendError(e);\r\n        return e;\r\n    }else if(e.error){\r\n        //sendError(e.error.message);\r\n        return e.error.message;\r\n    }else{\r\n       // throw new Error('No such record found');\r\n     //  sendError('No such record found');\r\n       return 'No such record found';\r\n    }\r\n}\r\n\r\nexport const getPlayer = (uid) => {\r\n    return firebase.firestore().collection(dbConfig.COLLECTION_PLAYERS).doc(uid).get()\r\n    .then(firestoreThenInline);\r\n}\r\n\r\n\r\nexport const getExam = (uid, examId) => {\r\n    return firebase.firestore().collection(dbConfig.COLLECTION_PLAYERS).doc(uid)\r\n                                .collection(dbConfig.COLLECTION_EXAMS).doc(examId).get();\r\n}\r\n\r\nexport const saveExam = (uid, examId, save) => {\r\n    return firebase.firestore().collection(dbConfig.COLLECTION_PLAYERS)\r\n                                .doc(uid)\r\n                                .collection(dbConfig.COLLECTION_EXAMS)\r\n                                .doc(examId).update({\r\n                                    save\r\n                                });\r\n}\r\n\r\nexport const deleteExam = (uid, examId) => {\r\n    return firebase.firestore()\r\n                    .collection(dbConfig.COLLECTION_PLAYERS)\r\n                    .doc(uid)\r\n                    .collection(dbConfig.COLLECTION_EXAMS)\r\n                    .doc(examId).delete()\r\n                    .then(e => {\r\n                        return firebase.firestore().collection(dbConfig.COLLECTION_PLAYERS).doc(uid).update({\r\n                            [`exams.${examId}`]: firebase.firestore.FieldValue.delete()\r\n                        })\r\n                    })\r\n}\r\n","import React, {useState, useEffect} from 'react';\r\nimport LoadScript from './../LoadScript'\r\nimport Subscribable from 'views/hoc/Subscribable';\r\nimport {log, sendError} from 'utilities/Measure.js';\r\n\r\n\r\nlet clientId = \"392303660392-if4osc2chaurcd8a5o6btcuud6r3rj91.apps.googleusercontent.com\";\r\n\r\nconst config = {\r\n    clientId: \"392303660392-if4osc2chaurcd8a5o6btcuud6r3rj91.apps.googleusercontent.com\",\r\n    scope: 'https://www.googleapis.com/auth/drive.file',\r\n    discoveryDocs: [\r\n      \"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\",\r\n      \"https://www.googleapis.com/discovery/v1/apis/classroom/v1/rest\",\r\n    ]\r\n};\r\n\r\nconst Gapi = (props) => {\r\n\r\n    const onLoad = (e) => {\r\n\r\n        gapi.load('client', () => {\r\n            props.doSubscribe('getGapi', ()=>{return gapi.client.init(config)},\r\n            (r)=>{\r\n              props.onApiInit('gapi');\r\n            },\r\n            e => {\r\n              sendError(`gapi client init rejected`);\r\n            },\r\n            (e)=>{\r\n              sendError(`gapi client onError called`)\r\n            })\r\n        });\r\n    }\r\n\r\n    return <LoadScript apiKey=\"cli\" script='https://apis.google.com/js/api.js' \r\n        onLoad={onLoad} />\r\n}\r\n\r\nexport default Subscribable(Gapi);","import React, {useEffect, useState} from 'react';\r\nimport styled from 'styled-components';\r\nimport PropTypes from 'prop-types';\r\n\r\nimport firebase from 'firebase/app';\r\n//import '@firebase/testing';\r\nimport \"firebase/auth\";\r\nimport \"firebase/functions\";\r\n\r\n\r\nimport {Helmet} from 'react-helmet';\r\nimport {log} from 'utilities/Measure.js';\r\nimport { globalHistory } from \"@reach/router\";\r\nimport Text from 'views/Text/Text/v1/Text.js';\r\nimport GetGapi from './GetGapi';\r\nimport LoadScript from './../LoadScript';\r\nimport { navigate } from \"gatsby\";\r\nimport {cloudCatch} from 'apis/firebase/cloudFunctions';\r\nimport {getUrlHash, getUrl} from 'utilities/Format';\r\nimport IconButton from 'views/IconButton/v1/IconButton.js';\r\n\r\nimport config from './../config';\r\nimport './styles.css';\r\n\r\n\r\nconst signInOptions = [\r\n    {\r\n        provider: firebase.auth.TwitterAuthProvider.PROVIDER_ID\r\n    },\r\n    {\r\n        provider: firebase.auth.FacebookAuthProvider.PROVIDER_ID\r\n    }\r\n]\r\n\r\nconst getGoogleProvider = (permissions) => {\r\n    return {\r\n        provider: firebase.auth.GoogleAuthProvider.PROVIDER_ID,\r\n        scopes: permissions, \r\n        customParameters: {\r\n            // Forces account selection even when one account\r\n            // is available.\r\n            //access_type: 'offline',\r\n            'include_granted_scopes': true, \r\n            //prompt: 'select_account'\r\n          }\r\n    }\r\n}\r\n\r\nconst uiConfig = {\r\n    signInFlow: 'redirect',\r\n    callbacks: {}\r\n}\r\nconst URL_HASH = \"#signed-in\";\r\nconst TEMP_HASH = \"#signing-in\";\r\n//SignInHoc(AssignmentView, id, needsGoogle, needsGapi, permissions);\r\nconst SignInHoC = (View, redirectUrl, needsGoogle) => props => {\r\n    if(!props.doSubscribe){\r\n        throw Error(`SignInHoc must be wrapped by subscribable`);\r\n    }\r\n    const [error, setError] = useState(null);\r\n    const [isGapiReady, setIsGapiReady] = useState(false);\r\n     const [user, setUser] = useState(false);\r\n    const [uiInstance, setUiInstance] = useState(null);\r\n\r\n    const onAuthStateChanged = (user) => {\r\n        setUser(getUser(user))\r\n    }\r\n    useEffect(()=>{\r\n        return ()=>{\r\n            deleteUi(uiInstance || getUi());\r\n        }\r\n    }, \r\n    [uiInstance])\r\n    useEffect(()=>{\r\n        if(isSigningIn() && window.firebaseui){\r\n            showSignInUi();\r\n        }\r\n    }, [isGapiReady, user])\r\n    useEffect(()=>{\r\n        /*dont know why this needs to be here, but the ui doesn't show without it*/\r\n        window.firebase = firebase; \r\n        if(firebase.apps.length === 0){\r\n            \r\n            firebase.initializeApp(config);\r\n            if(globalHistory.location.hostname === 'localhost'){\r\n              //firebase.functions().useFunctionsEmulator(\"http://localhost:5001\");\r\n            }\r\n          }\r\n        if(window && window.gapi && !isGapiReady){\r\n            setIsGapiReady(true);\r\n        }\r\n        firebase.auth().onAuthStateChanged(onAuthStateChanged);\r\n        setFirebaseToWindow();\r\n    }, [])\r\n    const watchConnection = () => {\r\n        var connectedRef = firebase.database().ref(\".info/connected\");\r\n        connectedRef.on('value', function(connectedSnap) {\r\n            setConnected(connectedSnap.val() === true);\r\n        })\r\n    }\r\n    const setFirebaseToWindow = (ref) => {\r\n        window.firebase = firebase; \r\n    }\r\n\r\n    const onSignOut = () => {\r\n        return props.doSubscribe('signInOut', ()=>{return firebase.auth().signOut()},\r\n        e => {\r\n            //resetUi();\r\n            deleteUi(getUi());\r\n            navigate(getUrl()) \r\n            return {success: 'logged out'}\r\n        },\r\n        e => {\r\n            return {error: `failed to sign out.`}\r\n        },\r\n        setError);\r\n    }\r\n\r\n    const showSignInUi = (permissions, attempts = 0) => {\r\n        console.log(`SignIn  showSignInUi`, props);\r\n        let ui = getUi();\r\n        if(!ui){\r\n            try{\r\n                firebase.auth().setPersistence(firebase.auth.Auth.Persistence.NONE)\r\n                //firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION)\r\n                resetUi(ui)\r\n                uiConfig.signInSuccessUrl = redirectUrl + URL_HASH;\r\n                window.location = getUrl() + TEMP_HASH;\r\n                uiConfig.callbacks.signInSuccessWithAuthResult =  postSignIn;\r\n             //   uiConfig.callbacks.signInFailure = (e) => {log(`bughunt SignInHoc callback signInFailure`, e)};\r\n                startUi(permissions);\r\n            }catch(e){\r\n                if(attempts < 1){\r\n                    showSignInUi(permissions, attempts + 1);\r\n                }\r\n            }\r\n        }else{\r\n            navigate(getUrl() + TEMP_HASH);\r\n        }\r\n    }\r\n    const getUi = ()=>{\r\n       // if(!isMounted) return null;\r\n       let fui;\r\n       if(firebaseui){\r\n        fui = firebaseui.auth.AuthUI.getInstance(getUiId());\r\n       }\r\n       if(!fui){\r\n           fui = uiInstance;\r\n       }\r\n        return fui;\r\n    }\r\n    const deleteUi = (fui) =>{\r\n        setUiInstance(null);\r\n        if(fui) fui.delete();\r\n        \r\n    }\r\n    const resetUi = (fui) => {\r\n        setUiInstance(null);\r\n        if(fui) fui.reset();\r\n    }\r\n    const startUi = (permissions) => {\r\n       \r\n        let newfui = getUi();\r\n        if(!newfui){\r\n            \r\n            let a = firebase.auth();\r\n            newfui = new firebaseui.auth.AuthUI(firebase.auth(), getUiId());\r\n        }\r\n        let google = getGoogleProvider(permissions);\r\n        newfui.start('#' + getUiId(), {...uiConfig, \r\n            signInOptions: [google, ...needsGoogle?[]:signInOptions]\r\n        });\r\n    }\r\n    const postSignIn = (authResult) => {\r\n        if(window && window.gapi && window.gapi.client && authResult && authResult.credential){\r\n            gapi.client.setToken({access_token: authResult.credential.accessToken});\r\n        }\r\n        return true;\r\n    }\r\n\r\n\r\n    const isSigningIn = () => {\r\n        return getUrlHash() === TEMP_HASH;\r\n    }\r\n    const cancelSignIn = () => {\r\n        navigate(getUrl())\r\n    }\r\n    const isSignedIn = () => {\r\n     //   if(connected && firebase.apps.length > 0 && user) return true;\r\n        if(user) return true;\r\n        return false;\r\n        //return connected && firebase.apps.length > 0 && firebase.auth().currentUser;// && !explicitSignOut;\r\n    }\r\n    const deleteUser = () => {\r\n        let u = firebase.auth().currentUser;\r\n        if(u){\r\n            return ()=>{\r\n                return u.delete()\r\n            }\r\n        }\r\n    }\r\n    const onGapiIsReady = () => {\r\n        setIsGapiReady(true); //callApiOnGapiReady\r\n    }\r\n    const getUser = (u) => {\r\n        if(u){\r\n           //let u = user;\r\n            return {uid: u.uid, email: u.email, displayName: u.displayName, photoURL: u.photoURL, \r\n                phoneNumber: u.phoneNumber, createTime: u.metadata.creationTime, lastTime: u.metadata.lastSignInTime,\r\n                provider: u.providerData.reduce((agg, el, i)=>{\r\n                    return agg + `${i > 0?', ':''}${el.providerId}`;\r\n                }, '')}\r\n        }\r\n        return null;\r\n    }\r\n\r\n    const getUiId = () => { \r\n        return `firebaseui-auth-container`\r\n    }\r\n    return (\r\n            <SignInWrapper>\r\n                <Helmet>\r\n                    <link type=\"text/css\" rel=\"stylesheet\" href=\"https://www.gstatic.com/firebasejs/ui/4.3.0/firebase-ui-auth.css\" />\r\n                </Helmet>\r\n                <GetGapi onApiInit={onGapiIsReady} />\r\n                <LoadScript onLoad={setFirebaseToWindow} \r\n                    script=\"https://www.gstatic.com/firebasejs/ui/4.3.0/firebase-ui-auth.js\"/>\r\n\r\n     \r\n                <StateBackground signingIn={isSigningIn()}>\r\n                    <StateView signingIn={isSigningIn()} className=\"bg-grad-pp\">\r\n                        <IconButton \r\n                            className=\"sign-in-close\"\r\n                            icon=\"icon-cross\"\r\n                            onInput={cancelSignIn}\r\n                            color=\"primary\"\r\n                            bgColor=\"black\"\r\n                        />\r\n                        \r\n                        {isSigningIn() && <div>\r\n                            <Text key=\"auth-message\" id=\"auth-message\" fontSize=\"remS\" className=\"inline\">\r\n                                By signing in, some of your personal information will be used for authentication.  \r\n                            </Text>\r\n                            <a href={'/privacy'} trget=\"_blank\">Read more here</a>\r\n                        </div>}\r\n                \r\n                        \r\n                        {error && <Text key=\"sign-error\" id=\"sign-error\"  className=\"text-center\" >error</Text>}\r\n                        {/* {!isOnline && <Text key=\"sign-offline\" id=\"sign-offline\"  className=\"text-center\" >you are offline</Text>} */}\r\n\r\n                        <div id={getUiId()} className=\"sign-in-wrapper\" />\r\n                    </StateView>\r\n                </StateBackground>\r\n                {isSignedIn() && <SignOutWrapper>\r\n                    <Text key=\"sign-out\" id=\"sign-out\" className=\"text-underline\" onInput={onSignOut} >sign out</Text>\r\n                </SignOutWrapper>}\r\n               {isGapiReady &&  <div className={`actionView ${isSignedIn()?'signedIn':'notSignedIn'}`}>\r\n               <View {...props} isSignedIn={isSignedIn()} user={user} doSignOut={onSignOut} deleteUser={deleteUser}\r\n                isGapiReady={isGapiReady} doSignIn={showSignInUi} \r\n                />\r\n                </div>}\r\n            \r\n            </SignInWrapper>\r\n    )\r\n}\r\n\r\n\r\nexport default SignInHoC;\r\n\r\nconst SignOutWrapper = styled.div`\r\n    position: fixed;\r\n    top:0px;\r\n    right:0px;\r\n    color: orange;\r\n`\r\n// height: 100%;\r\nconst SignInWrapper = styled.div`\r\n    text-align: center !important;\r\n\r\n`\r\nconst StateBackground = styled.div`\r\n    position: absolute;\r\n    top:0px;\r\n    bottom:0px;\r\n    left: 0px;\r\n    right:0px;\r\n    background-color: rgba(0,0,0,0.8);\r\n    transform: translateY(${props => props.signingIn?'0%':'-100%'});\r\n    transition: transform 1s ease-out;\r\n    z-index: ${props => props.theme.zUi};\r\n`\r\nconst StateView = styled.div`\r\n\r\n    width: 95%;\r\n    margin: auto;\r\n    margin-top:100px;\r\n    z-index: ${props => props.theme.zTop};\r\n    position: relative;\r\n    .sign-in-close{\r\n        position: absolute;\r\n        top: -25px;\r\n        left: 0px;\r\n    }\r\n`","\r\n\r\n\r\n\r\n\r\n\r\nconst config = {\r\n   // driveApiKey: 'AIzaSyDAHDS9Ia7fjc7MRYyD6zyKdRGZeRSrwrI',\r\n    //fireAPI: fireAPI,\r\n    apiKey: 'AIzaSyDAHDS9Ia7fjc7MRYyD6zyKdRGZeRSrwrI',\r\n    //authDomain: \"mathstims-7d4bb.firebaseapp.com\",\r\n    authDomain: \"auth.stimsims.com\",\r\n    databaseURL: \"https://mathstims-7d4bb.firebaseio.com\",\r\n    projectId: \"mathstims-7d4bb\", //\"quests-2cb9a\",\r\n    storageBucket: \"mathstims-7d4bb.appspot.com\",\r\n    clientId: \"392303660392-if4osc2chaurcd8a5o6btcuud6r3rj91.apps.googleusercontent.com\",\r\n    discoveryDocs: [\r\n      \"https://www.googleapis.com/discovery/v1/apis/drive/v3/rest\",\r\n      \"https://www.googleapis.com/discovery/v1/apis/classroom/v1/rest\",\r\n    ]\r\n  };\r\n\r\nexport default config;\r\n\r\nexport const studentPermissions = [\r\n  \"https://www.googleapis.com/auth/classroom.courses.readonly\",\r\n  \"https://www.googleapis.com/auth/classroom.coursework.me\",\r\n  \"https://www.googleapis.com/auth/drive.file\" //Recommended\r\n]\r\n\r\nexport const drivePermissions = [\r\n  \"https://www.googleapis.com/auth/drive.file\"\r\n]\r\n\r\n//for mass marking\r\nexport const teacherCreatePermissions = [\r\n  \"https://www.googleapis.com/auth/classroom.coursework.students\",\r\n  \"https://www.googleapis.com/auth/classroom.courses.readonly\",\r\n  'https://www.googleapis.com/auth/classroom.rosters.readonly',\r\n // \"https://www.googleapis.com/auth/drive.file\"\r\n]\r\n\r\nexport const teacherMarkPermissions = [\r\n  \"https://www.googleapis.com/auth/drive.metadata.readonly\",\r\n \"https://www.googleapis.com/auth/classroom.coursework.students\",\r\n \"https://www.googleapis.com/auth/classroom.courses.readonly\",\r\n]\r\n\r\n\r\n/*\r\nIf you store restricted scope data on servers (or transmit), then you need to go through a security assessment. \r\n\r\nif you plan to access or use a type of user data that was not originally disclosed in your \r\nprivacy policy when a Google user initially authorized access, you must update your privacy policy \r\nand prompt the user to consent to any changes before you may access that data.\r\n\r\nOnly certain application types may access Restricted Scopes for each product.\r\nProductivity and educational applications (including task management, note taking, workgroup communications, \r\n  and classroom collaboration applications) that only use Restricted Scopes to handle Drive files \r\n  (or their metadata or permissions) via the applicationâ€™s user interface\r\n\r\n  Limit your use of data to providing or improving user-facing features that are \r\n  prominent in the requesting application's user interface.\r\n\r\n  Only transfer the data to others if necessary to provide or improve user-facing features that are \r\n  prominent in the requesting application's user interface. \r\n\r\n  Don't allow humans to read the data\r\n\r\n   Applications accessing Restricted Scopes must demonstrate that they adhere to certain security practices. \r\n   These applications must pass an annual security assessment \r\nscope access:\r\n\"https://www.googleapis.com/auth/drive.file\" //Recommended\r\nhttps://www.googleapis.com/auth/drive.metadata restricted\r\n*/","import React, {useState, useEffect} from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport styled from 'styled-components';\r\nimport { graphql, Link } from 'gatsby';\r\nimport Loading from 'views/Loading/v1/Loading.js';\r\nimport Text from 'views/Text/Text/v1/Text.js';\r\nimport SiteContainer from 'views/Container/Container.js';\r\nimport UserAccount from 'views/AccountPage/user/index';\r\nimport AccountAnalytics from 'views/AccountPage/analytics/index';\r\nimport Header from 'views/Header/Header.js';\r\nimport {Helmet} from 'react-helmet';\r\nimport Meta from 'views/SEO/Meta/Meta';\r\nimport Reveal from 'views/Reveal/index.js';\r\nimport BarsBox from 'views/Box/Bars/index.js';\r\n\r\nconst AccountPage = (props) => {\r\n \r\n    return <SiteContainer key=\"account-page\" className=\"bg-tl-dark\">\r\n        <Helmet title={`Account Page | ${props.data.site.siteMetadata.title}`} />\r\n        <Meta   />\r\n        <Header center title={`Account Page`} />\r\n        <BarsBox minHeight=\"60px\">\r\n              <UserAccount />\r\n        </BarsBox>\r\n        <AccountAnalytics />\r\n    </SiteContainer>\r\n}\r\nAccountPage.propTypes = {\r\n    data: PropTypes.shape({\r\n      allMarkdownRemark: PropTypes.shape({\r\n        edges: PropTypes.array,\r\n      })\r\n    }),\r\n  }\r\nexport default AccountPage;\r\n\r\nconst AccountWrapper = styled.section`\r\nborder-top: 2px solid ${props => props.theme.text};\r\nborder-bottom: 2px solid ${props => props.theme.text};\r\nmax-width: ${props => props.theme.mediaL};\r\nmargin: auto;\r\n`\r\n\r\nexport const pageQuery = graphql`\r\n  query AccountQuery {\r\n    allSitePage {\r\n      edges {\r\n        node {\r\n          path\r\n        }\r\n      }\r\n    }\r\n    site {\r\n      siteMetadata {\r\n        ...siteDataFragment\r\n      }\r\n    }\r\n}\r\n`\r\n","const COLLECTION_EXAMS_TEST = 'testExams';\r\nconst COLLECTION_EXAMS_LIVE = 'exams';\r\nconst COLLECTION_PLAYERS_TEST = 'testPlayers';\r\nconst COLLECTION_PLAYERS_LIVE = 'players';\r\nconst COLLECTION_PAYMENTS_TEST = 'testPayments2';\r\nconst COLLECTION_PAYMENTS_LIVE = 'payments';\r\n\r\n\r\nconst PAY_EXAM_VALUE = '5.00';\r\nconst PAY_EXAM_VALUE_STRIPE = 500;\r\nconst PAY_EXAM_VALUE_PAYPAL = '5.00';\r\n\r\nconst PAY_REPORT_VALUE_STRIPE = 1000;\r\nconst PAY_REPORT_VALUE = '10.00';\r\nconst PAY_REPORT_VALUE_PAYPAL = '10.00';\r\n\r\nconst PAY_CURRENCY = 'AUD';\r\n\r\nconst PRODUCT_EXAM = 'exam';\r\nconst PRODUCT_REPORT = 'report';\r\n\r\nconst PAYPAL_ID = 'paypalId';\r\nconst STRIPE_ID = 'stripeId';\r\nconst STRIPE_SANDBOX_API_KEY = 'pk_test_TihZRayuBClTOrqPzysoX86p00rITy6lt2';\r\nconst STRIPE_LIVE_API_KEY = 'pk_live_NNcJevNYmVuwnZSVEPjCWdYv00Dri8SnWf';\r\nconst PAYPAL_SANDBOX_API_KEY = 'Aera3gBeOoXF6uFm2HwLeOeV90vnwc1VufL9bj1cTXyq05ArwaLUhPGg9VM8shjnw1w5yo7tQXLBdUMc';\r\nconst PAYPAL_LIVE_API_KEY ='ASk_D1qAbh_gjj7sOvXUUc1XadpS0sgykHgppBCe3mjYxA7PlayZxJhXJ0rjvxBK3k2fi_E1MpLd8Jjj';\r\n\r\nconst PAYPAL_MODE = 'live'; //sandbox live\r\nconst VENDOR_PAYPAL = 'paypal';\r\nconst VENDOR_STRIPE = 'stripe';\r\n\r\nconst FREE_EXAM = 3;\r\nconst FREE_REPORT = 3;\r\nconst REFUND_MAX_REPORT = 5;\r\nconst REFUND_MAX_EXAM = 5;\r\n\r\nconst getUnlockedKey = (type) => `unlocked${type}`;\r\nconst getCounterKey = (type) => `${type}count`;\r\nconst getFreeAmount = (type) => {\r\n    switch(type){\r\n        default: return FREE_REPORT;\r\n    }\r\n};\r\nconst getRefundAmount = (type) => {\r\n    switch(type){\r\n        default: return REFUND_MAX_REPORT;\r\n    }\r\n};\r\nconst getPaymentAmount = (vendor, product) => {\r\n    if(vendor === VENDOR_STRIPE){\r\n        if(product === PRODUCT_EXAM){\r\n            return PAY_EXAM_VALUE_STRIPE;\r\n        }else if(product === PRODUCT_REPORT){\r\n            return PAY_REPORT_VALUE_STRIPE;\r\n        }\r\n    }else if(vendor === VENDOR_PAYPAL){\r\n        if(product === PRODUCT_EXAM){\r\n            return PAY_EXAM_VALUE_PAYPAL;\r\n        }else if(product === PRODUCT_REPORT){\r\n            return PAY_REPORT_VALUE_PAYPAL;\r\n        }\r\n    }\r\n    throw Error(`invalid vendor ${vendor} or product ${product}`)\r\n}\r\nconst validateProduct = (product) => {\r\n    return product === PRODUCT_REPORT || product === PRODUCT_EXAM;\r\n}\r\n\r\nconst INITIAL_PLAYER_STATE = {reportcount: 0, examcount: 0};\r\n    //sandboxclientid\r\n\r\nexports.COLLECTION_PLAYERS = COLLECTION_PLAYERS_LIVE;     \r\nexports.COLLECTION_EXAMS = COLLECTION_EXAMS_LIVE;     \r\nexports.COLLECTION_PAYMENTS = COLLECTION_PAYMENTS_LIVE;     \r\nexports.PAY_EXAM_VALUE =  PAY_EXAM_VALUE;     \r\nexports.PAY_EXAM_VALUE_STRIPE =  PAY_EXAM_VALUE_STRIPE;     \r\nexports.PAY_REPORT_VALUE = PAY_REPORT_VALUE;     \r\nexports.PAY_REPORT_VALUE_STRIPE = PAY_REPORT_VALUE_STRIPE;     \r\nexports.PAY_CURRENCY = PAY_CURRENCY;     \r\nexports.PRODUCT_EXAM = PRODUCT_EXAM;     \r\nexports.PRODUCT_REPORT = PRODUCT_REPORT;     \r\nexports.PAYPAL_ID = PAYPAL_ID;     \r\nexports.STRIPE_ID = STRIPE_ID;     \r\nexports.FREE_EXAM = FREE_EXAM;     \r\nexports.FREE_REPORT = FREE_REPORT;     \r\nexports.INITIAL_PLAYER_STATE = INITIAL_PLAYER_STATE;     \r\nexports.getUnlockedKey = getUnlockedKey;     \r\nexports.getCounterKey = getCounterKey;     \r\nexports.getFreeAmount = getFreeAmount;\r\nexports.getRefundAmount = getRefundAmount;\r\nexports.getPaymentAmount = getPaymentAmount;\r\nexports.validateProduct = validateProduct;\r\n// exports.STRIPE_SANDBOX_API_KEY = STRIPE_SANDBOX_API_KEY;\r\n// exports.STRIPE_LIVE_API_KEY = STRIPE_LIVE_API_KEY;\r\nexports.STRIPE_API_KEY = STRIPE_LIVE_API_KEY;\r\nexports.PAYPAL_LIVE_API_KEY = PAYPAL_LIVE_API_KEY;\r\nexports.PAYPAL_SANDBOX_API_KEY = PAYPAL_SANDBOX_API_KEY;\r\nexports.PAYPAL_MODE = PAYPAL_MODE;\r\nexports.PAY_REPORT_VALUE_PAYPAL = PAY_REPORT_VALUE_PAYPAL;\r\nexports.PAY_EXAM_VALUE_PAYPAL = PAY_EXAM_VALUE_PAYPAL;\r\nexports.VENDOR_PAYPAL = VENDOR_PAYPAL;\r\nexports.VENDOR_STRIPE = VENDOR_STRIPE;","const firebase = require(\"firebase\");\r\n// Required for side-effects\r\nrequire(\"firebase/functions\");\r\nimport {log, sendError} from 'utilities/Measure';\r\n\r\n\r\nexport const getPermission = (permissions, onPermitted) => {\r\n    let user = firebase.auth().currentUser;\r\n    let provider = getProvider(firebase.auth().currentUser, permissions);\r\n    return {\r\n        //promise: ()=>{return firebase.auth().signInWithPopup(provider)},\r\n        promise: ()=>{return firebase.auth().signInWithRedirect(provider)},\r\n        then:function(result) {\r\n            if(window && window.gapi){\r\n                gapi.client.setToken({access_token: result.credential.accessToken});\r\n                onPermitted();\r\n            }\r\n          },\r\n        cat:function(error) {\r\n           if(error.message){\r\n            return error.message;\r\n           }\r\n           return error;\r\n        } \r\n    }\r\n}\r\n\r\n\r\nconst getGoogleProvider = (permissions) => {\r\n    let google =  new firebase.auth.GoogleAuthProvider();\r\n        if(permissions){\r\n            permissions.map(e => {\r\n                google.addScope(e);\r\n            })\r\n        }\r\n        return google;\r\n}\r\nconst getProvider = (user, permissions) => {\r\n    let providerId = user?user.providerData[0].providerId:null;\r\n    if(permissions){\r\n        return getGoogleProvider(permissions);\r\n    }else{\r\n        switch(providerId){\r\n            case 'google.com': return getGoogleProvider(permissions);\r\n            case 'twitter.com': return new firebase.auth.TwitterAuthProvider();\r\n            case 'facebook.com': return new firebase.auth.FacebookAuthProvider();\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport const cloudThen = (callback) => (e) => {\r\n    if(e.data && !e.data.hasOwnProperty('fail')){\r\n        callback(e.data);\r\n    }else if(e.data.hasOwnProperty('fail')){\r\n        if(typeof e.data.fail === 'string'){\r\n            throw new Error(e.data.fail);\r\n        }else{\r\n            throw new Error('cloud function failed');\r\n        }\r\n        \r\n    }else{\r\n        throw new Error('No such record found');\r\n    }\r\n}\r\nexport const cloudThenInline = (e) => {\r\n    if(e.data && !e.data.hasOwnProperty('fail')){\r\n        return e.data;\r\n    }else if(e.data.hasOwnProperty('fail')){\r\n        if(typeof e.data.fail === 'string'){\r\n            throw new Error(e.data.fail);\r\n        }else{\r\n            throw new Error('cloud function failed');\r\n        }\r\n        \r\n    }else{\r\n        throw new Error('No such record found');\r\n    }\r\n}\r\nexport const cloudCatch = (e) => {\r\n    if(e.result && e.result.error){\r\n        sendError(`cloudCatch ${e.result.error.message}`, false);\r\n        return e.result.error.message;\r\n    }else if(e.error){\r\n        sendError(`cloudCatch ${e.error}`, false);\r\n        return e.error;\r\n    }else if(e.message){\r\n        sendError(`cloudCatch ${e.message}`, false);\r\n        return  e.message;\r\n    }else if(typeof e === 'string'){\r\n        sendError(`cloudCatch ${e}`, false);\r\n        //may be an error string passed from thrown then error\r\n        return e;\r\n    }else{\r\n        sendError(`cloudCatch Incorrectly formatted cloudCatch error`, false);\r\n        //throw new Error('Incorrectly formatted cloudCatch error', e);\r\n        return 'Incorrectly formatted cloudCatch error';\r\n    }\r\n}\r\n\r\n\r\n//** EXAM */\r\n\r\nexport const loadExam = (examId) => {\r\n    return firebase.functions().httpsCallable('loadExam')({examId}).then(cloudThenInline);\r\n}\r\nexport const startExam = (game) => {\r\n    return firebase.functions().httpsCallable('startExam')({game}).then(cloudThenInline);\r\n}\r\nexport const createExam = (game, settings) => {\r\n    return firebase.functions().httpsCallable('createExam')({game, settings}).then(cloudThenInline);\r\n}\r\nexport const deletePlayer = (uid) => {\r\n    return firebase.functions().httpsCallable('deletePlayer')({uid});\r\n}\r\nexport const updateExam = (examId, game, node, local) => {\r\n    return firebase.functions().httpsCallable('updateExam')({examId, game, node, local}).then(cloudThenInline);\r\n}\r\n\r\n\r\nexport const endGame = (examId, game, local) => {\r\n    return firebase.functions().httpsCallable('endGame')({examId, game, local}).then(cloudThenInline);\r\n}\r\n\r\nexport const initExam = (examId, game, settings) => {\r\n    return firebase.functions().httpsCallable('initalizeExam')({examId, game, settings}).then(cloudThenInline);\r\n}\r\n\r\n\r\n\r\n\r\n\r\n/** STRIPE */\r\nexport const createPaymentIntent = (eventId, paymentType) => {\r\n    return firebase.functions().httpsCallable('createPaymentIntent')({eventId, paymentType})\r\n    .then(cloudThenInline);\r\n}\r\n\r\n\r\nexport const checkCustomerStatus = (eventId, paymentType) => {\r\n    return firebase.functions().httpsCallable('checkCustomerStatus')({eventId, paymentType})\r\n    .then(cloudThenInline);\r\n}\r\n\r\nexport const cancelPaymentIntent = (paymentIntentId) => {\r\n    return firebase.functions().httpsCallable('cancelPaymentIntent')({paymentIntentId})\r\n    .then(cloudThenInline);\r\n}\r\n\r\nexport const refundPayment = (paymentType) => {\r\n    return firebase.functions().httpsCallable('refundPayment')({paymentType})\r\n    .then(cloudThenInline);\r\n}\r\n\r\nexport const validateCaptcha = (token, v2) => {\r\n    return firebase.functions().httpsCallable('validateCaptcha')({token, v2})\r\n    .then(cloudThenInline);\r\n}\r\n\r\n//capturePaypalPayment\r\nexport const capturePaypalPayment = (orderID, authorizationID) => {\r\n    return firebase.functions().httpsCallable('capturePaypalPayment')({orderID, authorizationID})\r\n    .then(cloudThenInline);\r\n}\r\n","import React, {useEffect, useState} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {log} from 'utilities/Measure.js';\r\n\r\nconst LoadScript = (props) => {\r\n    useEffect(()=>{\r\n        loadScript()\r\n    }, []);\r\n    const loadScript = () => {\r\n\r\n      var script = document.createElement('script');\r\n      script.type = 'text/javascript';\r\n      script.src = props.script;\r\n      \r\n      // Once the Google API Client is loaded, you can run your code\r\n      script.onload = (e) => {\r\n       // Initialize the Google API Client with the config object\r\n          if(props.onLoad){\r\n                props.onLoad(e);\r\n          }\r\n  \r\n      }\r\n      // Add to the document\r\n      document.body.appendChild(script);\r\n\r\n    }\r\n    return null;\r\n}\r\n\r\nLoadScript.propTypes = {\r\n    onLoad: PropTypes.func,\r\n    script: PropTypes.string\r\n}\r\n\r\nexport default LoadScript;\r\n"],"sourceRoot":""}